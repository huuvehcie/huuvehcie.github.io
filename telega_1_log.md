# üî¶ –õ–æ–≥ –ê—É–¥–∏—Ç–∞ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ Telegram ¬´Telega¬ª (ru.dahl.messenger)

## 1\. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –£—Ç–∏–ª–∏—Ç üõ†Ô∏è

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Android-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ (APK), –∏—Ö –¥–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏/–¥–∏–∑–∞—Å—Å–µ–º–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

### –ó–∞–¥–∞—á–∞ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ë–∞–∑–æ–≤—ã—Ö –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ArchLinux

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Java Decompiler (Jadx) –∏ Android Debug Bridge (ADB)
sudo pacman -S jadx android-tools

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ APKTool (—á–µ—Ä–µ–∑ AUR)
paru -S apktool
```

### –ó–∞–¥–∞—á–∞ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Frida

–î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Frida. –£—Å—Ç–∞–Ω–æ–≤–∏–º –µ–≥–æ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∫–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –≤ ArchLinux.

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ virtualenv
sudo pacman -S python-virtualenv

# –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv frida_venv
source frida_venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ Frida
pip install frida-tools
```

-----

## 2\. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ê–Ω–∞–ª–∏–∑ (–î–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—è –∏ Grep) üîé

### –ó–∞–¥–∞—á–∞ 3: –î–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—è APK

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `apktool` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ Smali-–∫–æ–¥–∞.

```bash
# –î–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
apktool d Telega-1.11.3-TG-12.0.1.apk -o telega_decoded
```

### –ó–∞–¥–∞—á–∞ 4: –ê–Ω–∞–ª–∏–∑ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ (–ü–æ–∏—Å–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π)

–ü—Ä–æ–≤–µ—Ä—è–µ–º `AndroidManifest.xml` –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (`READ_CALL_LOG`, `ACCESS_BACKGROUND_LOCATION`) –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (`android:exported="true"`).

### –ó–∞–¥–∞—á–∞ 5: –ü–æ–∏—Å–∫ –ö–ª—é—á–µ–π MTProto (`grep` –ø–æ Smali)

–ò—Å–ø–æ–ª—å–∑—É—è `grep` –≤ –ø–∞–ø–∫–µ `telega_decoded`, –º—ã –∏—â–µ–º –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ (`API ID`, `API Hash`) –∏ –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

```bash
# –ü–æ–∏—Å–∫ API ID/Hash
grep -r "const-string" . | grep -E "API_ID|APP_ID|api_hash|API_HASH" 
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü—É—Å—Ç–æ.

# –ü–æ–∏—Å–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Ç–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
grep -r "native_set_int_config" .
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü—É—Å—Ç–æ.

# –ü–æ–∏—Å–∫ –∫–ª–∞—Å—Å–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
grep -r "config" . | grep -A 10 "config.dat"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–∞–π–¥–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ MessagesStorage, SharedConfig, AppGlobalConfig. 
# –í—ã–≤–æ–¥: –ö–ª—é—á–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ, –≤–µ—Ä–æ—è—Ç–Ω–µ–µ –≤—Å–µ–≥–æ, –æ–Ω–∏ –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω—ã –≤ –Ω–∞—Ç–∏–≤–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ libtmessages.49.so.
```

-----

## 3\. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ê–Ω–∞–ª–∏–∑ (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –°—Ç–µ–Ω–¥–∞ –∏ Frida) üöÄ

–ü–æ—Å–∫–æ–ª—å–∫—É —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –¥–∞–ª –∫–ª—é—á–µ–π, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É –∞–Ω–∞–ª–∏–∑—É —Å Frida.

### –ó–∞–¥–∞—á–∞ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AVD –∏ Root-–¥–æ—Å—Ç—É–ø

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å Frida —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–º—É–ª—è—Ç–æ—Ä.

1.  **–ó–∞–ø—É—Å–∫ AVD:** –ó–∞–ø—É—Å–∫–∞–µ–º —ç–º—É–ª—è—Ç–æ—Ä AVD (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ `x86_64` –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ **–æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –æ–±—Ä–∞–∑** –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä—É—Ç–∏—Ä–æ–≤–∞–Ω–∏—è).
2.  **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ APK:**
    ```bash
    adb install Telega-1.11.3-TG-12.0.1.apk
    ```
3.  **–ü–æ–ª—É—á–µ–Ω–∏–µ Root-–¥–æ—Å—Ç—É–ø–∞:** –í AVD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –º–µ—Ç–æ–¥ —Ä—É—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
    ```bash
    adb root
    adb shell
    whoami
    # –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥: root
    ```

### –ó–∞–¥–∞—á–∞ 7: –ó–∞–ø—É—Å–∫ Frida-Server

–ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º `frida-server` (–≤–µ—Ä—Å–∏—é `x86_64`) –Ω–∞ —Ä—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —ç–º—É–ª—è—Ç–æ—Ä–µ.

```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ ArchLinux (–≤–Ω–µ adb shell):
adb push frida-server /data/local/tmp/frida-server
adb shell "chmod 755 /data/local/tmp/frida-server"

# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ adb shell (—Å –ø—Ä–∞–≤–∞–º–∏ root):
emu64xa:/ # /data/local/tmp/frida-server 
# (–û—Å—Ç–∞–≤–ª—è–µ–º —ç—Ç–æ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã–º!)
```

### –ó–∞–¥–∞—á–∞ 8: –•—É–∫ v1 ‚Äî –ü–æ–∏—Å–∫ `NativeConfig`

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `config_hook.js` –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

```javascript
// config_hook.js
if (Java.available) {
    Java.perform(function () {
        var NativeConfig = Java.use('org.telegram.messenger.NativeConfig');
        // ... —Ö—É–∫–∏ putInt –∏ putString
    });
}
```

  * **–ö–æ–º–∞–Ω–¥–∞ (–≤ `(frida_venv)`):** `frida -U -f ru.dahl.messenger -l config_hook.js`
  * **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `java.lang.ClassNotFoundException: Didn't find class "org.telegram.messenger.NativeConfig"`
  * **–í—ã–≤–æ–¥:** **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è\!**

### –ó–∞–¥–∞—á–∞ 9: –•—É–∫ v2 ‚Äî –ê—Ç–∞–∫–∞ –Ω–∞ `AppGlobalConfig`

–ù–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `app_config_hook.js` –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∫–ª–∞—Å—Å–∞-–∫–∞–Ω–¥–∏–¥–∞—Ç–∞ `AppGlobalConfig`.

```javascript
// app_config_hook.js
if (Java.available) {
    Java.perform(function () {
        var AppGlobalConfig = Java.use('org.telegram.messenger.AppGlobalConfig');
        // ... –ø–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ get* –∏ is*
    });
}
```

  * **–ö–æ–º–∞–Ω–¥–∞ (–≤ `(frida_venv)`):** `frida -U -f ru.dahl.messenger -l app_config_hook.js`
  * **–†–µ–∑—É–ª—å—Ç–∞—Ç:** \`\`\`
    [+] Hooking org.telegram.messenger.AppGlobalConfig methods...
    TypeError: cannot read property 'forEach' of undefined
    ```
    ```
  * **–í—ã–≤–æ–¥:** **–ö–ª–∞—Å—Å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø—É—Å—Ç.** –í—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –∫–ª—é—á–∞–º–∏ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –Ω–∞—Ç–∏–≤–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É** `libtmessages.49.so`.

### –ó–∞–¥–∞—á–∞ 10: –•—É–∫ v3 ‚Äî –ê—Ç–∞–∫–∞ –Ω–∞ –ù–∞—Ç–∏–≤–Ω—ã–π –ö–æ–¥

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `native_hook.js` –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –Ω–∞—Ç–∏–≤–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `libtmessages.49.so` —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `JNI_OnLoad`.

```javascript
// native_hook.js
Interceptor.attach(Module.findExportByName("libtmessages.49.so", "JNI_OnLoad"), { 
    onEnter: function (args) { 
        // ...
    }
});
```

  * **–ö–æ–º–∞–Ω–¥–∞ (–≤ `(frida_venv)`):** `frida -U -f ru.dahl.messenger -l native_hook.js`
  * **–†–µ–∑—É–ª—å—Ç–∞—Ç:** \`\`\`
    TypeError: not a function
    ```
    –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **—Ä–µ–∑–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å/–∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å**.
    ```
  * **–í—ã–≤–æ–¥:** **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞\!** –§—É–Ω–∫—Ü–∏—è `JNI_OnLoad` –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–∞. –ù–∞–±–ª—é–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ **–∞–∫—Ç–∏–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º Anti-Frida** (–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞).

-----

## 4\. –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–µ –í—ã–≤–æ–¥—ã –∏ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏ üîë

–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–≤–æ–¥—ã:

1.  **–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –æ–ø–∞—Å–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è** (`READ_CALL_LOG`, `ACCESS_BACKGROUND_LOCATION`), —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–æ–º —à–ø–∏–æ–Ω–∞–∂–∞.
2.  **–°–∫—Ä—ã—Ç–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π:** –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–ª–∏ **–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –æ–±—Ñ—É—Å–∫–∞—Ü–∏—é** –∫–∞–∫ Java-–∫–ª–∞—Å—Å–æ–≤, —Ç–∞–∫ –∏ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** (`JNI_OnLoad`), –∏, –≤–µ—Ä–æ—è—Ç–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç **Anti-Frida –∑–∞—â–∏—Ç—É**.
3.  **–ù–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –ò–∑-–∑–∞ —Å–∫—Ä—ã—Ç–∏—è –∫–ª—é—á–µ–π **–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å**, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ MTProto, –∏ **–Ω–µ–ª—å–∑—è –∏—Å–∫–ª—é—á–∏—Ç—å** –ø–µ—Ä–µ—Ö–≤–∞—Ç –∏–ª–∏ —É—Ç–µ—á–∫—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä—ã.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –î–∞–ª—å–Ω–µ–π—à–∏–π –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±—É–µ—Ç **–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞** –Ω–∞—Ç–∏–≤–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `libtmessages.49.so` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Ghidra** –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–∫—Ä—ã—Ç—ã—Ö –∫–ª—é—á–µ–π –∏ –ª–æ–≥–∏–∫–∏.
