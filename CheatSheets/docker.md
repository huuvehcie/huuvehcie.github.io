# Руководство по использованию Docker для начинающих

## Содержание
1. [Введение в Docker](#введение-в-docker)
2. [Основные компоненты и термины](#основные-компоненты-и-термины)
3. [Ключевые команды Docker](#ключевые-команды-docker)
4. [Конфигурация Dockerfile](#конфигурация-dockerfile)
5. [Продвинутые сценарии и оптимизация](#продвинутые-сценарии-и-оптимизация)
6. [Пример Dockerfile](#пример-dockerfile)

---

## Введение в Docker

Docker — платформа для контейнеризации приложений, позволяющая упаковывать приложения и их зависимости в изолированные контейнеры для единообразного выполнения на разных системах. Она упрощает разработку, тестирование и развертывание, обеспечивая переносимость и изоляцию. Для начинающих Docker предоставляет простой способ запускать приложения без сложной настройки окружения. Таблица ниже систематизирует основы Docker, включая его назначение, параметры и типичные ошибки. Она помогает новичкам быстро понять, как использовать Docker, и избежать проблем, таких как неправильная установка или конфликты версий.

---

### Таблица: Основы Docker

| Аспект | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|--------|------------|-----------|---------|------------------|---------|----------------|
| **Инструмент Docker** | Контейнеризация приложений. | `--config` (путь к конфигурации), `--version` (проверка версии). | ```bash<br># Проверка версии<br>docker --version<br># Запуск с кастомной конфигурацией<br>docker --config ~/.docker run hello-world<br># Информация о системе<br>docker info<br>``` | **Ошибка**: `docker: command not found`.<br>**Решение**: Установить Docker (`sudo apt install docker.io` на Linux).<br>**Ошибка**: Отсутствие прав.<br>**Решение**: Добавить пользователя в группу `docker` (`sudo usermod -aG docker $USER`). | Упрощает развертывание и изоляцию. | Интегрируется с Docker Hub, CI/CD, оркестраторами. |
| **Совместимость** | Работает на Linux, macOS, Windows (с WSL2). | `--platform` (указание архитектуры). | ```bash<br># Запуск контейнера для ARM<br>docker run --platform linux/arm64 hello-world<br># Проверка конфигурации<br>docker system info<br>``` | **Ошибка**: Ошибка WSL2 на Windows.<br>**Решение**: Включить WSL2 и установить Docker Desktop.<br>**Ошибка**: Неподдерживаемая архитектура.<br>**Решение**: Указать `--platform`. | Зависит от ОС и версии Docker. | Требует Docker Engine; конфликты с устаревшими версиями. |

**Важно запомнить**: Docker Engine — ядро платформы. Используйте Docker Desktop на Windows/macOS и `docker.io` на Linux.

**Типичные ошибки**: Неправильная установка, отсутствие прав, несовместимость архитектуры.

---

## Основные компоненты и термины

Компоненты и термины Docker составляют основу работы с контейнерами. Понимание Docker Engine, образов, контейнеров и сетей позволяет эффективно проектировать и управлять приложениями. Таблица ниже описывает ключевые элементы и термины, их параметры, примеры и возможные проблемы. Она помогает новичкам освоить терминологию и избежать ошибок, таких как неправильное использование томов или сетей, а также понять, как компоненты взаимодействуют в экосистеме Docker.

---

### Таблица: Компоненты и термины Docker

| Компонент/Термин | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-------------------|------------|-----------|---------|------------------|---------|----------------|
| **Docker Engine** | Управляет контейнерами, образами, сетями. | `--host` (хост демона), `--tls` (шифрование). | ```bash<br># Запуск демона с TLS<br>dockerd --tls<br># Проверка статуса<br>systemctl status docker<br>``` | **Ошибка**: Демон не запущен.<br>**Решение**: Запустить `sudo systemctl start docker`.<br>**Ошибка**: Ошибка сокета.<br>**Решение**: Проверить права на `/var/run/docker.sock`. | Ядро Docker. | Взаимодействует с CLI, API, реестрами. |
| **Образ (Image)** | Шаблон для контейнеров. | `tag`, `repository`. | ```bash<br># Создание образа<br>docker build -t myapp:latest .<br># Просмотр образов<br>docker images<br>``` | **Ошибка**: Образ не найден.<br>**Решение**: Выполнить `docker pull`.<br>**Ошибка**: Ошибка сборки.<br>**Решение**: Проверить Dockerfile. | Определяет содержимое контейнера. | Связан с Docker Hub, Dockerfile. |
| **Контейнер (Container)** | Изолированная среда для приложения. | `--name`, `--rm` (удаление после остановки). | ```bash<br># Запуск контейнера<br>docker run --name myapp -d myapp:latest<br># Список контейнеров<br>docker ps<br>``` | **Ошибка**: Контейнер не запускается.<br>**Решение**: Проверить логи (`docker logs`).<br>**Ошибка**: Конфликт имен.<br>**Решение**: Указать уникальное имя. | Запускает приложение. | Зависит от образа, сети, томов. |
| **Сеть (Network)** | Обеспечивает связь контейнеров. | `driver` (bridge, host, overlay). | ```bash<br># Создание сети<br>docker network create mynet<br># Подключение контейнера<br>docker run --network mynet myapp<br>``` | **Ошибка**: Контейнеры не связаны.<br>**Решение**: Указать сеть.<br>**Ошибка**: Конфликт сетей.<br>**Решение**: Удалить дубли (`docker network rm`). | Изолирует или объединяет контейнеры. | Влияет на доступность. |
| **Том (Volume)** | Хранит данные вне контейнера. | `--mount`, `type` (volume, bind). | ```bash<br># Создание тома<br>docker volume create myvol<br># Запуск с томом<br>docker run -v myvol:/data myapp<br>``` | **Ошибка**: Том не монтируется.<br>**Решение**: Проверить путь.<br>**Ошибка**: Права доступа.<br>**Решение**: Настроить права (`chmod`). | Обеспечивает сохранность данных. | Взаимодействует с хостовой ФС. |

**Важно запомнить**: Образы — шаблоны, контейнеры — экземпляры, тома — хранилища, сети — связи.

**Типичные ошибки**: Ошибки сборки, конфликты имен, неправильные пути к томам.

---

## Ключевые команды Docker

Команды Docker — основной инструмент для управления контейнерами, образами, сетями и томами. Они позволяют создавать, запускать, мониторить и удалять ресурсы. Таблица ниже описывает ключевые команды, их параметры, примеры и возможные ошибки. Она помогает новичкам быстро освоить управление Docker, избегая проблем, таких как занятые порты или устаревшие образы, и понять, как команды влияют на систему и взаимодействуют с компонентами.

---

### Таблица: Ключевые команды Docker

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|----------------|
| **docker build** | Создает образ из Dockerfile. | `-t` (тег), `--build-arg` (аргументы). | ```bash<br># Сборка образа<br>docker build -t myapp:latest .<br># Сборка с аргументом<br>docker build --build-arg APP_ENV=prod -t myapp .<br># Сборка без кэша<br>docker build --no-cache -t myapp .<br>``` | **Ошибка**: Ошибка синтаксиса.<br>**Решение**: Проверить Dockerfile.<br>**Ошибка**: Недостаточно памяти.<br>**Решение**: Увеличить лимиты. | Создает образ. | Влияет на реестры, контейнеры. |
| **docker run** | Запускает контейнер из образа. | `-d` (фоновый режим), `-p` (порты). | ```bash<br># Запуск в фоне<br>docker run -d -p 8080:80 myapp<br># Запуск с именем<br>docker run --name myapp myapp:latest<br># Запуск с томом<br>docker run -v myvol:/data myapp<br>``` | **Ошибка**: Порт занят.<br>**Решение**: Изменить порт в `-p`.<br>**Ошибка**: Образ не найден.<br>**Решение**: Выполнить `docker pull`. | Создает и запускает контейнер. | Влияет на сети, тома. |
| **docker pull** | Загружает образ из реестра. | `--platform` (архитектура). | ```bash<br># Загрузка образа<br>docker pull nginx:latest<br># Загрузка для ARM<br>docker pull --platform linux/arm64 nginx<br>``` | **Ошибка**: Ошибка авторизации.<br>**Решение**: Выполнить `docker login`.<br>**Ошибка**: Образ не найден.<br>**Решение**: Проверить имя/тег. | Загружает образ. | Взаимодействует с Docker Hub. |
| **docker exec** | Выполняет команду в контейнере. | `-it` (интерактивный режим). | ```bash<br># Запуск bash<br>docker exec -it myapp bash<br># Выполнение команды<br>docker exec myapp ls /app<br>``` | **Ошибка**: Контейнер не запущен.<br>**Решение**: Запустить `docker start`.<br>**Ошибка**: Команда не найдена.<br>**Решение**: Проверить образ. | Выполняет действия в контейнере. | Зависит от состояния контейнера. |
| **docker logs** | Показывает логи контейнера. | `--tail` (кол-во строк), `-f` (поток). | ```bash<br># Показать логи<br>docker logs myapp<br># Поток логов<br>docker logs -f myapp<br># Последние 100 строк<br>docker logs --tail 100 myapp<br>``` | **Ошибка**: Логи пусты.<br>**Решение**: Проверить, запущен ли контейнер.<br>**Ошибка**: Слишком много данных.<br>**Решение**: Использовать `--tail`. | Помогает в отладке. | Не влияет на ресурсы. |

**Важно запомнить**: Используйте `-d` для фонового режима, `-p` для проброса портов, `--rm` для автоудаления.

**Типичные ошибки**: Занятые порты, отсутствие образов, ошибки авторизации.

---

## Конфигурация Dockerfile

Файл `Dockerfile` — текстовый сценарий для создания Docker-образов, описывающий шаги сборки, зависимости и настройки. Он автоматизирует создание воспроизводимых окружений. Таблица ниже описывает ключевые инструкции Dockerfile, их назначение, примеры и возможные ошибки. Она помогает новичкам правильно составлять Dockerfile, избегая проблем, таких как неправильные пути или избыточные слои, и понять, как инструкции влияют на образ и взаимодействуют с контейнерами.

---

### Таблица: Инструкции Dockerfile

| Инструкция | Назначение | Варианты | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|------------|------------|----------|---------|------------------|---------|----------------|
| **FROM** | Указывает базовый образ. | `tag`, `--platform`. | ```dockerfile<br>FROM python:3.9<br>```<br>```dockerfile<br>FROM --platform=linux/arm64 nginx:latest<br>``` | **Ошибка**: Образ не найден.<br>**Решение**: Проверить Docker Hub.<br>**Ошибка**: Неподдерживаемая платформа.<br>**Решение**: Указать `--platform`. | Определяет основу образа. | Влияет на все слои. |
| **WORKDIR** | Задает рабочую директорию. | Абсолютный или относительный путь. | ```dockerfile<br>WORKDIR /app<br>```<br>```dockerfile<br>WORKDIR /app/src<br>``` | **Ошибка**: Директория не создана.<br>**Решение**: WORKDIR создает её автоматически.<br>**Ошибка**: Неправильный путь.<br>**Решение**: Использовать абсолютный путь. | Упрощает пути для команд. | Влияет на COPY, RUN, CMD. |
| **COPY** | Копирует файлы в образ. | `source`, `destination`. | ```dockerfile<br>COPY requirements.txt /app/<br>```<br>```dockerfile<br>COPY src/ /app/src/<br>``` | **Ошибка**: Файл не найден.<br>**Решение**: Проверить путь на хосте.<br>**Ошибка**: Права доступа.<br>**Решение**: Настроить права. | Добавляет файлы в образ. | Взаимодействует с WORKDIR. |
| **RUN** | Выполняет команду при сборке. | Команда или список. | ```dockerfile<br>RUN pip install -r requirements.txt<br>```<br>```dockerfile<br>RUN apt-get update && apt-get install -y curl<br>``` | **Ошибка**: Команда завершилась ошибкой.<br>**Решение**: Проверить синтаксис.<br>**Ошибка**: Большие слои.<br>**Решение**: Объединить команды (`&&`). | Создает новый слой. | Увеличивает размер образа. |
| **EXPOSE** | Указывает порты приложения. | Порт, протокол (tcp/udp). | ```dockerfile<br>EXPOSE 8080<br>```<br>```dockerfile<br>EXPOSE 8080/tcp<br>``` | **Ошибка**: Порт не работает.<br>**Решение**: Проверить приложение и `docker run -p`.<br>**Ошибка**: Неправильный порт.<br>**Решение**: Указать корректный порт. | Документирует порты. | Требует `-p` при запуске. |

**Важно запомнить**: Используйте минимальные базовые образы, объединяйте команды в RUN, проверяйте пути.

**Типичные ошибки**: Неправильные пути, избыточные слои, ошибки синтаксиса.

---

## Продвинутые сценарии и оптимизация

Продвинутые сценарии Docker включают оптимизацию образов, управление кластерами через Swarm и интеграцию с CI/CD. Эти возможности позволяют создавать эффективные и масштабируемые приложения. Таблица ниже описывает сложные операции, их параметры, примеры и возможные ошибки. Она помогает новичкам освоить профессиональные техники, избегая проблем, таких как перерасход ресурсов или ошибки конфигурации Swarm, и понять, как интегрировать Docker в сложные процессы.

---

### Таблица: Продвинутые сценарии

| Сценарий | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|----------|------------|----------|---------|------------------|---------|----------------|
| **Оптимизация образов** | Уменьшает размер и время сборки. | `--no-cache`, многоступенчатая сборка. | ```dockerfile<br># Многоступенчатая сборка<br>FROM python:3.9 AS builder<br>COPY requirements.txt .<br>RUN pip install -r requirements.txt<br>FROM python:3.9-slim<br>COPY --from=builder /usr/local/lib/python3.9 /usr/local/lib/python3.9<br>``` | **Ошибка**: Большой образ.<br>**Решение**: Использовать slim-образы.<br>**Ошибка**: Долгая сборка.<br>**Решение**: Кэшировать слои. | Уменьшает размер и время. | Влияет на хранение, развертывание. |
| **Docker Swarm** | Управляет кластером контейнеров. | `--replicas`, `--mode`. | ```bash<br># Инициализация Swarm<br>docker swarm init<br># Создание сервиса<br>docker service create --replicas 3 --name myapp myapp:latest<br>``` | **Ошибка**: Узел не присоединяется.<br>**Решение**: Проверить токен и порт.<br>**Ошибка**: Сервис не запускается.<br>**Решение**: Проверить образ. | Обеспечивает масштабируемость. | Интегрируется с сетями, сервисами. |
| **CI/CD интеграция** | Автоматизирует сборку и развертывание. | `push`, `build`. | ```bash<br># Сборка и отправка<br>docker build -t myrepo/myapp:latest .<br>docker push myrepo/myapp:latest<br>``` | **Ошибка**: Ошибка авторизации.<br>**Решение**: Выполнить `docker login`.<br>**Ошибка**: Неправильный тег.<br>**Решение**: Указать корректный тег. | Ускоряет развертывание. | Интегрируется с GitHub Actions, Jenkins. |
| **HEALTHCHECK** | Проверяет состояние контейнера. | `--interval`, `--timeout`. | ```dockerfile<br>HEALTHCHECK --interval=30s --timeout=3s CMD curl -f http://localhost || exit 1<br>``` | **Ошибка**: Проверка не проходит.<br>**Решение**: Проверить URL/порт.<br>**Ошибка**: Слишком частые проверки.<br>**Решение**: Увеличить интервал. | Повышает надежность. | Влияет на оркестраторы. |

**Важно запомнить**: Используйте многоступенчатые сборки, HEALTHCHECK для надежности, Swarm для масштабирования.

**Типичные ошибки**: Большие образы, ошибки авторизации, неправильная конфигурация Swarm.

---

## Пример Dockerfile

Пример `Dockerfile` демонстрирует конфигурацию для создания образа с использованием различных инструкций, таких как `FROM`, `WORKDIR`, `COPY`, `RUN`, `EXPOSE`, `VOLUME`, `STOPSIGNAL`, `ONBUILD`, `ARG`, `HEALTHCHECK` и `SHELL`. Он включает подробные комментарии для понимания каждого шага и альтернативные варианты использования. Этот пример, взятый из предоставленного файла, помогает новичкам использовать его как шаблон для собственных проектов.

---

```dockerfile
# Используем базовый образ (FROM)
# FROM указывает, какой образ будет использоваться как основа.
# Образы скачиваются с Docker Hub по умолчанию, но можно указать кастомный репозиторий.
# Пример 1: Официальный образ Python с Docker Hub
FROM python:3.9
# Пример 2: Кастомный образ из приватного репозитория
FROM my-private-registry.com/custom-image:latest
# Пример 3: Указание платформы (например, ARM или x86_64)
FROM --platform=linux/amd64 python:3.9

# Устанавливаем метаданные для образа (LABEL)
# LABEL позволяет добавить метаданные к образу.
# Форматирование: ключ=значение. Можно использовать несколько строк.
# Пример 1: Одна строка метаданных
LABEL maintainer="your-email@example.com"
# Пример 2: Несколько строк метаданных
LABEL version="1.0" description="Example Dockerfile" build_date="2023-10-01"
# Цвет: Метки не поддерживают цвет, так как это просто текстовые метаданные.

# Устанавливаем рабочую директорию внутри контейнера (WORKDIR)
# WORKDIR задает рабочую директорию для всех последующих инструкций.
# Зачем нужна рабочая директория:
# 1. Упрощает управление путями внутри контейнера.
# 2. Предотвращает ошибки при работе с относительными путями.
# Пример 1: Создание директории `/app` и установка её как рабочей
WORKDIR /app
# Пример 2: Переключение на вложенную директорию
WORKDIR /app/src

# Копируем файлы из локальной системы в контейнер (COPY)
# COPY копирует файлы или директории из хостовой системы в контейнер.
# Первый аргумент — путь на хосте, второй — путь в контейнере.
# Пример 1: Копирование одного файла
COPY requirements.txt /app/
# Пример 2: Копирование всей директории
COPY src/ /app/src/
# Пример 3: Копирование нескольких файлов
COPY file1.txt file2.txt /app/

# Запускаем команду внутри контейнера (RUN)
# RUN выполняет команду во время сборки образа.
# Пути указываются относительно WORKDIR, если не указан абсолютный путь.
# Пример 1: Установка зависимостей
RUN pip install --no-cache-dir -r requirements.txt
# Пример 2: Создание директории и изменение прав доступа
RUN mkdir /logs && chmod 755 /logs
# Пример 3: Использование абсолютных путей
RUN cp /source/file.txt /destination/file.txt

# Добавляем файлы в контейнер (ADD)
# ADD похож на COPY, но имеет дополнительные возможности:
# 1. Распаковка архивов.
# 2. Скачивание файлов по URL.
# Пример 1: Распаковка архива
ADD example.tar.gz /app/
# Пример 2: Скачивание файла по URL
ADD https://example.com/file.txt /app/file.txt
# Пример 3: Копирование локального файла
ADD local-file.txt /app/local-file.txt

# Публикуем порт контейнера (EXPOSE)
# EXPOSE информирует Docker о том, что контейнер будет слушать указанный порт.
# Чтобы порт действительно слушался, нужно настроить приложение внутри контейнера.
# Пример 1: Открытие порта 8000
EXPOSE 8000
# Пример 2: Указание протокола (TCP или UDP)
EXPOSE 8000/tcp
# Внутри контейнера: Приложение должно быть настроено на прослушивание указанного порта.

# Создаем том (VOLUME)
# VOLUME создает точку монтирования для данных, которые должны сохраняться вне контейнера.
# Пути указываются относительно контейнера.
# На хостовой машине Docker автоматически создает директорию для тома.
# Пример 1: Создание тома `/data`
VOLUME /data
# Пример 2: Указание нескольких томов
VOLUME ["/data", "/logs"]
# Где находятся данные на хосте: Docker создает директорию в `/var/lib/docker/volumes/`.

# Определяем временную точку остановки (STOPSIGNAL)
# STOPSIGNAL определяет сигнал, который будет отправлен контейнеру при его остановке.
# На хостовой машине сигнал отправляется через `docker stop`.
# Пример 1: Использование стандартного сигнала SIGTERM
STOPSIGNAL SIGTERM
# Пример 2: Использование другого сигнала (например, SIGKILL)
STOPSIGNAL SIGKILL

# Импортируем другой Dockerfile (ONBUILD)
# ONBUILD определяет команды, которые будут выполнены при использовании этого образа как базового.
# Дочерний образ — это образ, который использует текущий образ как базовый.
# Пример 1: Команда, которая выполнится в дочернем образе
ONBUILD COPY . /app
# Пример 2: Установка зависимостей в дочернем образе
ONBUILD RUN pip install --no-cache-dir -r requirements.txt

# Определяем аргументы сборки (ARG)
# ARG позволяет передавать параметры во время сборки образа.
# Аргументы бывают:
# 1. Простые переменные (например, BUILD_VERSION).
# 2. Переменные с значениями по умолчанию.
# Пример 1: Определение аргумента без значения
ARG BUILD_VERSION
# Пример 2: Определение аргумента со значением по умолчанию
ARG APP_ENV=production
# Передача аргументов: `docker build --build-arg BUILD_VERSION=1.0 .`

# Пример использования HEALTHCHECK
# HEALTHCHECK проверяет работоспособность контейнера.
# Команда выполняется внутри контейнера.
# Пример 1: Проверка HTTP-сервера
HEALTHCHECK --interval=30s --timeout=10s \
  CMD curl -f http://localhost:8000/health || exit 1
# Пример 2: Проверка TCP-соединения
HEALTHCHECK --interval=30s --timeout=5s \
  CMD nc -z localhost 8000 || exit 1
# Интервал, таймаут и код выхода настраиваются через флаги.

# Пример использования SHELL
# SHELL изменяет оболочку по умолчанию для выполнения команд.
# Оболочка должна содержаться внутри контейнера.
# Пример 1: Изменение оболочки на bash
SHELL ["/bin/bash", "-c"]
# Пример 2: Возврат к шеллу по умолчанию
SHELL ["/bin/sh", "-c"]
```