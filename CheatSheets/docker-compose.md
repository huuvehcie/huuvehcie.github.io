## Основные компоненты архитектуры Docker Compose

| Компонент | Описание |
| --- | --- |
| Docker-compose.yml | Основной файл конфигурации Docker Compose, который описывает все службы, сети, тома и другие ресурсы, необходимые для запуска приложения. Он определяет структуру и параметры развертывания приложения. |
| Службы (Services) | Службы представляют собой отдельные контейнеры в приложении Docker Compose. Каждая служба определяет образ Docker, параметры запуска, зависимости и другие настройки. |
| Сети (Networks) | Docker Compose позволяет создавать и управлять сетями для связи между контейнерами. Сети могут быть внешними или внутренними. |
| Объемы (Volumes) | Объемы хранят данные вне контейнера, обеспечивая постоянство при перезапуске. Они могут быть именованными, анонимными или подключенными к хосту. |
| Секрета (Secrets) | Секретами являются безопасные переменные для хранения конфиденциальной информации. Docker Compose обеспечивает их безопасное управление. |
| Конфигурации (Configs) | Конфигурации используются для управления конфигурационными файлами контейнеров. |
| Зависмости (Dependencies) | Docker Compose определяет порядок запуска служб в зависимости от их взаимосвязей. |
| Переменные среды (Environment Variables) | Переменные среды настраивают поведение приложений в контейнерах. |
| Реплики (Replicas) | Реплики обеспечивают масштабирование служб и высокую доступность. |

## Основные термины Docker Compose

| Термин | Описание |
| --- | --- |
| Контейнер | Стандартизированная, изолированная среда для запуска приложения с операционной системой и зависимостями. |
| Образ | Шаблон для создания контейнеров, содержащий операционную систему и приложения. |
| Docker-compose | Инструмент для управления несколькими контейнерами Docker как единым приложением. |
| Служба | Определение контейнера в Docker Compose с параметрами и зависимостями. |
| Композиция (Compose file) | Файл конфигурации Docker Compose, описывающий приложение. |
| Docker Hub | Общедоступный реестр Docker для хранения и обмена образами. |
| Композиция проекта (Compose project) | Набор связанных контейнеров, управляемых Docker Compose. |
| Build | Процесс создания образа Docker из Dockerfile. |
| Команды (Commands) | Набор команд для управления приложениями Docker Compose (up, down, start, stop и т.д.). |

## Основные операции Docker Compose

| Операция | Описание |
| --- | --- |
| docker-compose up | Запускает и создает все службы, определенные в файле docker-compose.yml. |
| docker-compose down | Останавливает и удаляет все ресурсы, созданные командой `up`. |
| docker-compose ps | Отображает список запущенных контейнеров Docker Compose. |
| docker-compose start/stop | Запускает или останавливает контейнеры без удаления ресурсов. |
| docker-compose logs | Отображает логи контейнеров Docker Compose. |
| docker-compose exec | Выполняет команду внутри запущенного контейнера. |
| docker-compose scale | Масштабирует количество экземпляров службы. |
| docker-compose build | Создает или пересобирает образы Docker для служб. |
| docker-compose pull | Загружает последние образы Docker для служб из реестра. |
| docker-compose push | Отправляет образы Docker для служб в реестр. |

## Пример файла docker-compose

```yaml
# Версия спецификации Docker Compose (version)
# Указывает версию формата файла docker-compose.yml.
# Например, версия 3.x поддерживает новые функции, такие как deploy.
# Пример: version: '3.8'
version: '3.8'

# Определяем сервисы (services)
# services — это основной раздел, где описываются контейнеры.
# Каждый сервис представляет собой отдельный контейнер.
services:
  # Первый сервис: web-приложение
  web:
    # Используем базовый образ (image)
    # image указывает, какой образ будет использоваться для контейнера.
    # Можно использовать готовый образ из Docker Hub или собственный.
    # Пример: image: python:3.9
    image: python:3.9

    # Альтернатива: сборка образа из Dockerfile (build)
    # build указывает путь к Dockerfile для создания образа.
    # context — корневая директория для сборки.
    # dockerfile — имя Dockerfile (по умолчанию "Dockerfile").
    # Пример 1: Сборка из текущей директории
    # build: .
    # Пример 2: Сборка с указанием контекста и Dockerfile
    # build:
    #   context: ./web
    #   dockerfile: Dockerfile.prod

    # Указываем команду для запуска контейнера (command)
    # command заменяет CMD в Dockerfile.
    # Пример 1: Запуск Python-скрипта
    command: python app.py
    # Пример 2: Передача нескольких аргументов
    # command: ["python", "app.py", "--debug"]

    # Публикуем порты (ports)
    # ports связывает порты хостовой системы с портами контейнера.
    # Формат: "хост:контейнер".
    # Пример 1: Открытие порта 8000
    ports:
      - "8000:8000"
    # Пример 2: Открытие нескольких портов
    # ports:
    #   - "8000:8000"
    #   - "8080:80"
    # Пример 3: Только внутренний порт (доступен только внутри сети Docker)
    # ports:
    #   - "8000"

    # Монтируем тома (volumes)
    # volumes позволяют монтировать директории или файлы между хостом и контейнером.
    # Пример 1: Монтирование директории с кодом
    volumes:
      - ./src:/app
    # Пример 2: Монтирование локального файла
    # volumes:
    #   - ./config.json:/app/config.json
    # Пример 3: Монтирование именованного тома
    # volumes:
    #   - data_volume:/data

    # Указываем переменные окружения (environment)
    # environment задает переменные окружения внутри контейнера.
    # Пример 1: Явное указание переменных
    environment:
      APP_ENV: production
      LOG_LEVEL: info
    # Пример 2: Загрузка переменных из файла
    # env_file:
    #   - .env

    # Указываем зависимости (depends_on)
    # depends_on определяет порядок запуска контейнеров.
    # Важно: Это только гарантирует порядок запуска, но не ждет готовности сервисов.
    # Для проверки готовности используйте скрипты или инструменты вроде wait-for-it.sh.
    depends_on:
      - db

    # Задаем метки для контейнера (labels)
    # labels добавляют метаданные к контейнеру.
    # Пример:
    labels:
      com.example.description: "Web application"
      com.example.version: "1.0"

    # Указываем сетевые настройки (networks)
    # networks задает сети, к которым подключается контейнер.
    # Пример:
    networks:
      - app_network

    # Ограничиваем ресурсы (deploy)
    # deploy позволяет настроить ресурсы для контейнера (например, CPU, память).
    # Работает только в режиме Docker Swarm.
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M

  # Второй сервис: база данных
  db:
    # Используем базовый образ PostgreSQL
    image: postgres:13

    # Указываем переменные окружения для PostgreSQL
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: mydb

    # Монтируем том для хранения данных базы данных
    volumes:
      - db_data:/var/lib/postgresql/data

    # Подключаемся к пользовательской сети
    networks:
      - app_network

# Определяем именованные тома (volumes)
# volumes создают именованные тома для хранения данных.
# Пример 1: Создание тома db_data
volumes:
  db_data:
  # Пример 2: Создание дополнительного тома
  data_volume:

# Определяем сети (networks)
# networks создают пользовательские сети для связи контейнеров.
# Пример: Создание сети app_network с драйвером bridge
networks:
  app_network:
    driver: bridge
```
