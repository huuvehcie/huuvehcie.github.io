# Руководство по Kubernetes для начинающих

## Содержание
1. [Термины и определения](#термины-и-определения)
2. [Архитектура и компоненты Kubernetes](#архитектура-и-компоненты-kubernetes)
3. [Основные операции в Kubernetes](#основные-операции-в-kubernetes)
4. [Управление подами и сервисами](#управление-подами-и-сервисами)
5. [Масштабирование и обновление приложений](#масштабирование-и-обновление-приложений)
6. [Управление конфигурацией и секретами](#управление-конфигурацией-и-секретами)
7. [Сетевое взаимодействие и доступ](#сетевое-взаимодействие-и-доступ)
8. [Мониторинг и диагностика](#мониторинг-и-диагностика)
9. [Продвинутые сценарии и автоматизация](#продвинутые-сценарии-и-автоматизация)
10. [Справочник команд и параметров](#справочник-команд-и-параметров)

---

## Термины и определения

| Термин | Определение |
|--------|-------------|
| **Кластер** | Группа серверов (узлов), объединённых для выполнения контейнеризованных приложений. Кластер управляется мастер-узлом, который координирует задачи, такие как запуск контейнеров, масштабирование и обновление. Обеспечивает высокую доступность и отказоустойчивость приложений. |
| **Узел (Node)** | Отдельный сервер в кластере, выполняющий задачи по запуску контейнеров или управлению кластером. Рабочие узлы (Worker Nodes) запускают приложения, а мастер-узлы (Master Nodes) управляют кластером. Каждый узел имеет свои ресурсы (CPU, память, хранилище). |
| **Под (Pod)** | Минимальная единица в Kubernetes, содержащая один или несколько контейнеров, которые совместно используют сеть и хранилище. Поды создаются для выполнения приложений и управляются как единое целое. Обычно под содержит одно основное приложение и, возможно, вспомогательные контейнеры. |
| **Сервис (Service)** | Абстракция, обеспечивающая стабильный сетевой адрес для группы подов. Сервисы распределяют трафик между подами, предоставляя балансировку нагрузки и доступ как внутри кластера, так и извне. Используются для связи между компонентами приложения. |
| **Развертывание (Deployment)** | Ресурс, управляющий жизненным циклом подов, включая их создание, обновление и масштабирование. Развертывания обеспечивают декларативный подход, позволяя задавать желаемое состояние приложения, а Kubernetes автоматически его поддерживает. |
| **Реплика (ReplicaSet)** | Ресурс, гарантирующий запуск заданного числа копий подов. Используется для обеспечения доступности приложения, автоматически заменяя отказавшие поды. Обычно управляется развертываниями. |
| **Контейнер** | Лёгкая изолированная среда для выполнения приложения, содержащая код, зависимости и настройки. Контейнеры в подах работают совместно, разделяя ресурсы. |
| **Мастер-узел (Master Node)** | Узел, управляющий кластером. Содержит компоненты, такие как API-сервер, планировщик и менеджер контроллеров, которые координируют работу кластера и распределяют задачи по рабочим узлам. |
| **Рабочий узел (Worker Node)** | Узел, выполняющий контейнеры. Содержит kubelet для управления контейнерами и kube-proxy для сетевых операций. Рабочие узлы получают команды от мастер-узла. |
| **Конфигурационная карта (ConfigMap)** | Ресурс для хранения неконфиденциальных данных в формате ключ-значение. Используется для передачи настроек в поды, таких как переменные окружения или файлы конфигурации. |
| **Секрет (Secret)** | Ресурс для хранения конфиденциальных данных, таких как пароли, ключи или токены. Секреты защищают данные и передаются в поды безопасно. |
| **Пространство имён (Namespace)** | Логическое разделение ресурсов кластера для изоляции проектов, команд или окружений. Позволяет управлять доступом и избегать конфликтов имён. |
| **Вход (Ingress)** | Ресурс для управления внешним доступом к сервисам, обычно через HTTP/HTTPS. Обеспечивает маршрутизацию, балансировку нагрузки и SSL-терминацию. |
| **Том (Volume)** | Хранилище, доступное подам для сохранения данных. Может быть временным (удаляется с подом) или постоянным (сохраняется между перезапусками). |
| **Постоянный том (PersistentVolume, PV)** | Ресурс хранилища, предоставляемый кластером. Используется для долговременного хранения данных, независимо от жизненного цикла подов. |
| **Запрос на том (PersistentVolumeClaim, PVC)** | Запрос пода на использование постоянного тома. Упрощает доступ к хранилищу, связывая под с подходящим PV. |
| **Сетевая политика (NetworkPolicy)** | Правила, определяющие, как поды могут взаимодействовать по сети. Используются для ограничения трафика и повышения безопасности. |
| **Kubelet** | Агент на рабочем узле, управляющий запуском и состоянием контейнеров. Взаимодействует с мастер-узлом через API-сервер. |
| **Kube-proxy** | Компонент на рабочем узле, управляющий сетевыми правилами и маршрутизацией трафика между подами и сервисами. |
| **kubectl** | Инструмент командной строки для управления кластером Kubernetes. Позволяет создавать, просматривать и изменять ресурсы через команды. |
| **Хелм (Helm)** | Пакетный менеджер для упрощения установки и управления приложениями в Kubernetes. Использует чарты для описания ресурсов. |
| **Чарт (Chart)** | Пакет в Helm, содержащий описание ресурсов Kubernetes для установки приложения. Упрощает развертывание сложных приложений. |
| **Тейнт (Taint)** | Метка на узле, ограничивающая размещение подов. Используется для управления, какие поды могут запускаться на узле. |
| **Толерантность (Toleration)** | Настройка пода, позволяющая игнорировать тейнты узла. Используется для точного управления размещением подов. |
| **Жаргон: "Куб" (Kube)** | Сокращение от Kubernetes, часто используется в разговорах (например, "куб кластер"). |
| **Жаргон: "Подох" (Pod died)** | Неформальное выражение, означающее, что под завершил работу или был удалён из-за ошибки. |
| **Жаргон: "Роллаут" (Rollout)** | Процесс обновления приложения в Kubernetes, когда новые версии подов постепенно заменяют старые. |

---

## Архитектура и компоненты Kubernetes

Kubernetes — это платформа для оркестрации контейнеров, которая автоматизирует развертывание, масштабирование и управление приложениями. Архитектура Kubernetes состоит из мастер-узлов, управляющих кластером, и рабочих узлов, выполняющих контейнеры. Компоненты, такие как API-сервер, планировщик и хранилище etcd, обеспечивают координацию и управление, а ресурсы, такие как поды, сервисы и развертывания, определяют, как приложения запускаются и взаимодействуют. Понимание архитектуры помогает новичкам эффективно управлять кластером, настраивать ресурсы и диагностировать проблемы. Таблица ниже предоставляет обзор ключевых компонентов, их функций, вариантов настройки и возможных проблем, упрощая изучение для начинающих.

Таблица компонентов используется для понимания ролей каждого элемента в кластере, их взаимодействия и влияния на систему. Она помогает новичкам быстро освоить, какие компоненты отвечают за конкретные задачи, как они настраиваются и какие проблемы могут возникнуть. Например, знание роли kubelet позволяет диагностировать сбои на рабочих узлах, а понимание etcd помогает защитить данные кластера. Таблица также раскрывает продвинутые сценарии, такие как настройка отказоустойчивости или интеграция с облачными провайдерами, что пригодится при дальнейшем изучении.

| Компонент | Назначение | Параметры настройки | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------|------------|---------------------|---------|------------------|---------|----------------|
| **kube-apiserver** | Обрабатывает API-запросы, предоставляет интерфейс для управления кластером. | `--secure-port`, `--authorization-mode` | ```bash<br># Просмотр статуса API-сервера<br>kubectl get componentstatuses<br># Настройка порта<br>kube-apiserver --secure-port=6443<br>``` | **Ошибка**: API-сервер недоступен.<br>**Решение**: Проверить сетевые правила, перезапустить сервис.<br>**Ошибка**: Ошибка авторизации.<br>**Решение**: Настроить RBAC. | Влияет на доступность всех операций кластера. | Связан с kubectl, etcd, kubelet. |
| **etcd** | Хранит состояние кластера (ресурсы, конфигурации). | `--data-dir`, `--backup` | ```bash<br># Проверка статуса etcd<br>etcdctl member list<br># Создание резервной копии<br>etcdctl snapshot save backup.db<br>``` | **Ошибка**: Данные повреждены.<br>**Решение**: Восстановить из резервной копии.<br>**Ошибка**: Высокая задержка.<br>**Решение**: Оптимизировать диск. | Потеря etcd приводит к потере состояния кластера. | Используется kube-apiserver. |
| **kube-scheduler** | Распределяет поды по узлам на основе ресурсов и политик. | `--policy-config-file` | ```bash<br># Проверка логов планировщика<br>kubectl logs kube-scheduler<br># Настройка политики<br>kube-scheduler --policy-config-file=policy.yaml<br>``` | **Ошибка**: Поды не распределяются.<br>**Решение**: Проверить ресурсы узлов.<br>**Ошибка**: Конфликт политик.<br>**Решение**: Уточнить приоритеты. | Влияет на производительность и доступность подов. | Взаимодействует с kube-apiserver, kubelet. |
| **kube-controller-manager** | Управляет контроллерами (например, ReplicaSet). | `--controllers` | ```bash<br># Проверка статуса<br>kubectl get componentstatuses<br># Настройка контроллеров<br>kube-controller-manager --controllers="*"<br>``` | **Ошибка**: Контроллер не создаёт поды.<br>**Решение**: Проверить лимиты.<br>**Ошибка**: Зависание.<br>**Решение**: Перезапустить. | Влияет на стабильность ресурсов. | Связан с kube-apiserver, ReplicaSet. |
| **kubelet** | Запускает и управляет контейнерами на узле. | `--config`, `--max-pods` | ```bash<br># Проверка статуса kubelet<br>systemctl status kubelet<br># Ограничение подов<br>kubelet --max-pods=100<br>``` | **Ошибка**: Контейнеры не запускаются.<br>**Решение**: Проверить образ.<br>**Ошибка**: Ошибка сети.<br>**Решение**: Настроить CNI. | Влияет на выполнение подов на узле. | Связан с kube-apiserver, kube-proxy. |
| **kube-proxy** | Управляет сетевыми правилами и маршрутизацией. | `--proxy-mode` | ```bash<br># Проверка логов<br>kubectl logs kube-proxy<br># Настройка режима<br>kube-proxy --proxy-mode=iptables<br>``` | **Ошибка**: Сеть недоступна.<br>**Решение**: Проверить iptables.<br>**Ошибка**: Задержки.<br>**Решение**: Оптимизировать CNI. | Влияет на сетевую связность подов. | Связан с kubelet, сервисами. |

**Важно запомнить**: Каждый компонент критичен для работы кластера; отказ одного может нарушить функциональность. Регулярно проверяйте статус компонентов через `kubectl get componentstatuses`.

**Типичные ошибки**: Неправильная настройка сети для kube-apiserver или потеря данных в etcd. Используйте резервное копирование и мониторинг.

---

## Основные операции в Kubernetes

Операции в Kubernetes выполняются через `kubectl`, инструмент командной строки, который взаимодействует с API-сервером кластера. Эти операции позволяют создавать, обновлять, удалять и диагностировать ресурсы, такие как поды, сервисы и развертывания. Таблица ниже охватывает основные команды, их параметры и сценарии использования, упрощая управление кластером для новичков. Она помогает быстро освоить базовые задачи, такие как запуск приложения или проверка состояния ресурсов, а также диагностировать проблемы. Понимание операций важно для повседневной работы с кластером, от развертывания приложений до управления узлами.

Таблица операций предоставляет чёткую структуру для выполнения задач, включая примеры, параметры и решения ошибок. Она полезна для начинающих, так как показывает, как команды влияют на кластер и как устранять сбои. Например, команда `kubectl apply` упрощает обновление приложений, а `kubectl logs` помогает в диагностике. Таблица также включает продвинутые сценарии, такие как автоматизация через скрипты, что пригодится при дальнейшем изучении Kubernetes.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|----------------|
| **kubectl create** | Создаёт ресурсы (поды, сервисы, развертывания). | `--image`, `--dry-run` | ```bash<br># Создание развертывания<br>kubectl create deployment nginx --image=nginx<br># Проверка без создания<br>kubectl create pod test --image=busybox --dry-run=client -o yaml<br>``` | **Ошибка**: Неверный образ.<br>**Решение**: Указать правильный образ.<br>**Ошибка**: Конфликт имён.<br>**Решение**: Использовать уникальное имя. | Создаёт новые ресурсы, увеличивает нагрузку. | kube-apiserver, kube-scheduler. |
| **kubectl get** | Получает информацию о ресурсах. | `--all-namespaces`, `-o wide` | ```bash<br># Список подов<br>kubectl get pods<br># Подробный вывод<br>kubectl get nodes -o wide<br>``` | **Ошибка**: Ресурс не найден.<br>**Решение**: Проверить пространство имён.<br>**Ошибка**: Ошибка доступа.<br>**Решение**: Настроить RBAC. | Не изменяет кластер, только запрашивает данные. | kube-apiserver. |
| **kubectl apply** | Применяет конфигурацию из файлов. | `-f`, `--record` | ```bash<br># Применение YAML<br>kubectl apply -f deployment.yaml<br># Сохранение истории<br>kubectl apply -f service.yaml --record<br>``` | **Ошибка**: Неверный YAML.<br>**Решение**: Проверить синтаксис.<br>**Ошибка**: Конфликт версий.<br>**Решение**: Удалить и пересоздать. | Обновляет или создаёт ресурсы. | kube-apiserver, ReplicaSet. |
| **kubectl delete** | Удаляет ресурсы. | `--force`, `--grace-period` | ```bash<br># Удаление пода<br>kubectl delete pod my-pod<br># Принудительное удаление<br>kubectl delete deployment nginx --force<br>``` | **Ошибка**: Ресурс не удаляется.<br>**Решение**: Указать `--force`.<br>**Ошибка**: Зависимости.<br>**Решение**: Удалить связанные ресурсы. | Уменьшает нагрузку, освобождает ресурсы. | kube-apiserver, kubelet. |
| **kubectl exec** | Выполняет команду в контейнере. | `-it`, `--container` | ```bash<br># Запуск bash<br>kubectl exec -it my-pod -- bash<br># Проверка файлов<br>kubectl exec my-pod -- ls /app<br>``` | **Ошибка**: Контейнер не найден.<br>**Решение**: Указать правильный контейнер.<br>**Ошибка**: Нет bash.<br>**Решение**: Использовать sh. | Влияет на состояние контейнера. | kubelet. |
| **kubectl logs** | Показывает логи контейнера. | `--follow`, `--previous` | ```bash<br># Просмотр логов<br>kubectl logs my-pod<br># Следить за логами<br>kubectl logs my-pod --follow<br>``` | **Ошибка**: Логи недоступны.<br>**Решение**: Проверить состояние пода.<br>**Ошибка**: Логи пусты.<br>**Решение**: Проверить приложение. | Не изменяет кластер, только читает данные. | kubelet. |

**Важно запомнить**: Используйте `kubectl apply` для декларативного управления, а `kubectl get` для быстрой проверки состояния.

**Типичные ошибки**: Неправильное пространство имён или отсутствие прав. Всегда проверяйте контекст с `kubectl config view`.

---

## Управление подами и сервисами

Поды и сервисы — основа работы приложений в Kubernetes. Поды содержат контейнеры, выполняющие приложение, а сервисы обеспечивают доступ к подам через стабильный адрес. Управление этими ресурсами включает создание, мониторинг и настройку сетевого взаимодействия. Таблица ниже описывает команды и параметры для работы с подами и сервисами, включая примеры и решения ошибок. Она помогает новичкам быстро освоить базовые задачи, такие как запуск приложения или настройка доступа, а также понять, как диагностировать проблемы, например, недоступность сервиса.

Таблица предназначена для понимания, как создавать и управлять подами и сервисами, а также как они взаимодействуют с другими компонентами. Она упрощает процесс настройки приложений, показывая, какие команды использовать и как избежать типичных ошибок. Например, команда `kubectl expose` создаёт сервис для доступа к приложению, а `kubectl describe` помогает найти причину сбоев. Таблица также включает продвинутые сценарии, такие как настройка сетевых политик, что полезно для дальнейшего изучения.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|----------------|
| **kubectl run** | Создаёт под с одним контейнером. | `--image`, `--restart` | ```bash<br># Создание пода<br>kubectl run nginx --image=nginx<br># Создание с перезапуском<br>kubectl run test --image=busybox --restart=Never<br>``` | **Ошибка**: Неверный образ.<br>**Решение**: Проверить реестр.<br>**Ошибка**: Под не запускается.<br>**Решение**: Проверить логи. | Создаёт новый под, увеличивает нагрузку. | kube-apiserver, kubelet. |
| **kubectl expose** | Создаёт сервис для пода или развертывания. | `--port`, `--type` | ```bash<br># Создание сервиса<br>kubectl expose deployment nginx --port=80<br># Сервис типа NodePort<br>kubectl expose pod my-pod --port=8080 --type=NodePort<br>``` | **Ошибка**: Сервис недоступен.<br>**Решение**: Проверить тип сервиса.<br>**Ошибка**: Порт занят.<br>**Решение**: Изменить порт. | Создаёт сетевой доступ к подам. | kube-apiserver, kube-proxy. |
| **kubectl describe** | Показывает детали ресурса. | `--namespace` | ```bash<br># Детали пода<br>kubectl describe pod my-pod<br># Детали сервиса<br>kubectl describe service nginx<br>``` | **Ошибка**: Ресурс не найден.<br>**Решение**: Проверить имя.<br>**Ошибка**: Пустой вывод.<br>**Решение**: Указать пространство имён. | Не изменяет кластер, только читает данные. | kube-apiserver. |

**Важно запомнить**: Используйте сервисы для стабильного доступа к подам, так как поды могут перезапускаться.

**Типичные ошибки**: Неправильный тип сервиса или отсутствие подов. Проверяйте селекторы сервиса с `kubectl describe`.

---

## Масштабирование и обновление приложений

Масштабирование и обновление приложений в Kubernetes обеспечивают высокую доступность и актуальность кода. Команды, такие как `kubectl scale` и `kubectl rollout`, позволяют изменять количество реплик и управлять обновлениями. Таблица ниже описывает эти операции, их параметры и сценарии, помогая новичкам освоить управление жизненным циклом приложений. Она показывает, как масштабировать приложение под нагрузку или откатить неудачное обновление, а также как диагностировать связанные проблемы.

Таблица помогает понять, как поддерживать доступность приложений и управлять их версиями. Она упрощает задачи, такие как увеличение числа подов для обработки трафика или откат к предыдущей версии в случае сбоя. Продвинутые сценарии, такие как настройка Horizontal Pod Autoscaler (HPA), готовят новичков к автоматизации масштабирования. Таблица также объясняет влияние команд на кластер и взаимодействие с другими компонентами.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|----------------|
| **kubectl scale** | Изменяет количество реплик. | `--replicas` | ```bash<br># Масштабирование<br>kubectl scale deployment nginx --replicas=3<br># Уменьшение<br>kubectl scale deployment nginx --replicas=1<br>``` | **Ошибка**: Недостаточно ресурсов.<br>**Решение**: Проверить лимиты.<br>**Ошибка**: Реплики не создаются.<br>**Решение**: Проверить образ. | Изменяет нагрузку и доступность. | kube-apiserver, ReplicaSet. |
| **kubectl rollout** | Управляет обновлениями и откатами. | `status`, `undo` | ```bash<br># Проверка статуса<br>kubectl rollout status deployment nginx<br># Откат<br>kubectl rollout undo deployment nginx<br>``` | **Ошибка**: Обновление зависло.<br>**Решение**: Проверить образ.<br>**Ошибка**: Откат не работает.<br>**Решение**: Указать ревизию. | Влияет на версию приложения. | kube-apiserver, Deployment. |

**Важно запомнить**: Используйте `rollout status` для мониторинга обновлений и `undo` для быстрого отката.

**Типичные ошибки**: Неверный образ в обновлении или недостаток ресурсов. Проверяйте логи и лимиты.

---

## Управление конфигурацией и секретами

Конфигурации и секреты в Kubernetes позволяют передавать настройки и конфиденциальные данные в поды. ConfigMap хранит неконфиденциальные данные, а Secret — пароли и ключи. Таблица ниже описывает команды для работы с этими ресурсами, их параметры и примеры, упрощая настройку приложений для новичков. Она помогает понять, как безопасно управлять данными и диагностировать проблемы, такие как отсутствие секрета.

Таблица предназначена для настройки приложений, таких как передача переменных окружения или ключей API. Она показывает, как создавать и использовать ConfigMap и Secret, а также как устранять ошибки, например, неправильные ключи. Продвинутые сценарии, такие как автоматизация создания секретов, готовят к сложным задачам. Таблица также объясняет влияние на поды и взаимодействие с другими компонентами.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|----------------|
| **kubectl create configmap** | Создаёт ConfigMap. | `--from-literal`, `--from-file` | ```bash<br># Создание из значения<br>kubectl create configmap my-config --from-literal=key1=value1<br># Из файла<br>kubectl create configmap my-config --from-file=config.txt<br>``` | **Ошибка**: Неверный формат.<br>**Решение**: Проверить файл.<br>**Ошибка**: ConfigMap не применяется.<br>**Решение**: Проверить под. | Передаёт настройки в поды. | kube-apiserver, поды. |
| **kubectl create secret** | Создаёт Secret. | `--from-literal`, `--from-file` | ```bash<br># Создание секрета<br>kubectl create secret generic my-secret --from-literal=password=123<br># Из файла<br>kubectl create secret generic my-secret --from-file=key.pem<br>``` | **Ошибка**: Секрет не найден.<br>**Решение**: Проверить имя.<br>**Ошибка**: Ошибка декодирования.<br>**Решение**: Использовать base64. | Передаёт конфиденциальные данные. | kube-apiserver, поды. |

**Важно запомнить**: Используйте Secret для конфиденциальных данных и ConfigMap для общих настроек.

**Типичные ошибки**: Неправильный формат данных или отсутствие прав. Проверяйте base64 для секретов.

---

## Сетевое взаимодействие и доступ

Сетевое взаимодействие в Kubernetes обеспечивает связь между подами, сервисами и внешними клиентами. Ресурсы, такие как Service и Ingress, управляют трафиком, а сетевые политики ограничивают доступ. Таблица ниже описывает команды и параметры для настройки сети, помогая новичкам настроить доступ к приложениям и защитить кластер. Она упрощает задачи, такие как настройка Ingress или ограничение трафика.

Таблица помогает понять, как организовать сетевую связность и безопасность. Она показывает, как создавать сервисы, настраивать Ingress и применять сетевые политики, а также как диагностировать проблемы, такие как недоступность сервиса. Продвинутые сценарии, такие как настройка SSL, готовят к реальным задачам. Таблица также объясняет влияние на кластер и взаимодействие с компонентами.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|----------------|
| **kubectl create service** | Создаёт сервис. | `--type`, `--port` | ```bash<br># Создание ClusterIP<br>kubectl create service clusterip my-service --tcp=80<br># Создание NodePort<br>kubectl create service nodeport my-service --tcp=8080<br>``` | **Ошибка**: Сервис недоступен.<br>**Решение**: Проверить селектор.<br>**Ошибка**: Порт занят.<br>**Решение**: Изменить порт. | Создаёт сетевой доступ. | kube-apiserver, kube-proxy. |
| **kubectl apply (Ingress)** | Применяет Ingress. | `-f` | ```bash<br># Создание Ingress<br>kubectl apply -f ingress.yaml<br># Проверка<br>kubectl get ingress<br>``` | **Ошибка**: Ingress не работает.<br>**Решение**: Проверить контроллер.<br>**Ошибка**: SSL ошибка.<br>**Решение**: Настроить сертификат. | Управляет внешним трафиком. | kube-apiserver, Ingress Controller. |

**Важно запомнить**: Используйте Ingress для HTTP/HTTPS и сетевые политики для безопасности.

**Типичные ошибки**: Неправильный селектор сервиса или отсутствие Ingress Controller. Проверяйте конфигурации.

---

## Мониторинг и диагностика

Мониторинг и диагностика в Kubernetes позволяют отслеживать состояние кластера и устранять сбои. Команды, такие как `kubectl top` и `kubectl logs`, предоставляют информацию о ресурсах и ошибках. Таблица ниже описывает инструменты мониторинга и диагностики, помогая новичкам быстро находить и решать проблемы. Она упрощает задачи, такие как проверка использования CPU или анализ логов.

Таблица предназначена для диагностики проблем и мониторинга производительности. Она показывает, как использовать команды для получения данных о подах, узлах и контейнерах, а также как устранять ошибки, такие как перегрузка узла. Продвинутые сценарии, такие как интеграция с Prometheus, готовят к автоматизированному мониторингу. Таблица также объясняет влияние команд и их взаимодействие.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|----------------|
| **kubectl top** | Показывает использование ресурсов. | `--namespace` | ```bash<br># Использование подов<br>kubectl top pods<br># Узлы<br>kubectl top nodes<br>``` | **Ошибка**: Метрики недоступны.<br>**Решение**: Установить Metrics Server.<br>**Ошибка**: Пустой вывод.<br>**Решение**: Проверить пространство имён. | Не изменяет кластер, только читает данные. | kube-apiserver, Metrics Server. |
| **kubectl logs** | Показывает логи контейнера. | `--follow`, `--previous` | ```bash<br># Логи пода<br>kubectl logs my-pod<br># Предыдущие логи<br>kubectl logs my-pod --previous<br>``` | **Ошибка**: Логи недоступны.<br>**Решение**: Проверить состояние пода.<br>**Ошибка**: Логи пусты.<br>**Решение**: Проверить приложение. | Не изменяет кластер, только читает данные. | kubelet. |

**Важно запомнить**: Используйте `kubectl top` для мониторинга ресурсов и `kubectl logs` для диагностики.

**Типичные ошибки**: Отсутствие Metrics Server или неправильное имя пода. Проверяйте зависимости.

---

## Продвинутые сценарии и автоматизация

Продвинутые сценарии в Kubernetes включают автоматизацию, интеграцию и настройку безопасности. Инструменты, такие как Helm, и ресурсы, такие как NetworkPolicy, упрощают сложные задачи. Таблица ниже описывает команды и параметры для продвинутых сценариев, помогая новичкам освоить автоматизацию и безопасность. Она упрощает задачи, такие как установка приложений через Helm или настройка RBAC.

Таблица предназначена для перехода от базовых задач к сложным, таким как управление чартами Helm или настройка политик безопасности. Она показывает, как автоматизировать развертывание и защищать кластер, а также как устранять ошибки, такие как конфликты политик. Таблица также объясняет влияние на кластер и взаимодействие с компонентами, готовя к реальным задачам.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|----------------|
| **helm install** | Устанавливает приложение через Helm. | `--values`, `--set` | ```bash<br># Установка чарта<br>helm install my-app stable/nginx<br># С настройками<br>helm install my-app stable/nginx --set service.type=NodePort<br>``` | **Ошибка**: Чарт не найден.<br>**Решение**: Добавить репо.<br>**Ошибка**: Конфликт имён.<br>**Решение**: Указать уникальное имя. | Разворачивает сложные приложения. | kube-apiserver, поды. |
| **kubectl apply (NetworkPolicy)** | Применяет сетевую политику. | `-f` | ```bash<br># Создание политики<br>kubectl apply -f networkpolicy.yaml<br># Проверка<br>kubectl get networkpolicy<br>``` | **Ошибка**: Политика не работает.<br>**Решение**: Проверить CNI.<br>**Ошибка**: Неверный селектор.<br>**Решение**: Уточнить селектор. | Ограничивает сетевой трафик. | kube-apiserver, kube-proxy. |

**Важно запомнить**: Используйте Helm для сложных приложений и сетевые политики для безопасности.

**Типичные ошибки**: Неправильные настройки Helm или отсутствие CNI. Проверяйте зависимости.

---

## Справочник команд и параметров

```bash
# Создание ресурсов
kubectl create deployment <name> --image=<image>  # Создаёт развертывание
kubectl create pod <name> --image=<image>        # Создаёт под
kubectl create service clusterip <name> --tcp=<port>  # Создаёт сервис ClusterIP

# Просмотр ресурсов
kubectl get pods --all-namespaces                # Список всех подов
kubectl get services -o wide                    # Подробный список сервисов
kubectl get nodes                               # Список узлов

# Управление конфигурацией
kubectl create configmap <name> --from-literal=<key>=<value>  # Создаёт ConfigMap
kubectl create secret generic <name> --from-literal=<key>=<value>  # Создаёт Secret

# Диагностика
kubectl describe pod <name>                      # Детали пода
kubectl logs <name> --follow                    # Логи контейнера
kubectl top pods                                # Использование ресурсов

# Масштабирование и обновление
kubectl scale deployment <name> --replicas=<n>   # Изменение числа реплик
kubectl rollout undo deployment <name>           # Откат обновления

# Сеть
kubectl expose deployment <name> --port=<port> --type=<type>  # Создаёт сервис
kubectl apply -f ingress.yaml                    # Применяет Ingress

# Продвинутые сценарии
helm install <release> <chart> --set <key>=<value>  # Установка чарта Helm
kubectl apply -f networkpolicy.yaml              # Применение сетевой политики
```