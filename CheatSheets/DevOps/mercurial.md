# Mercurial

## Содержание
- [Терминология](#терминология)
- [Установка и настройка](#установка-и-настройка)
- [Создание и управление репозиторием](#создание-и-управление-репозиторием)
- [Работа с файлами и коммитами](#работа-с-файлами-и-коммитами)
- [Управление ветками и слияниями](#управление-ветками-и-слияниями)
- [Работа с удаленными репозиториями](#работа-с-удаленными-репозиториями)
- [Продвинутые сценарии](#продвинутые-сценарии)
- [Конфигурационные параметры](#конфигурационные-параметры)

## Терминология

| Термин | Описание |
|--------|----------|
| Репозиторий | Хранилище, содержащее файлы проекта и историю их изменений. Mercurial использует репозиторий для отслеживания версий файлов, позволяя разработчикам фиксировать изменения, возвращаться к предыдущим состояниям и совместно работать над проектом. Локальный репозиторий находится на компьютере пользователя, а удаленный — на сервере. |
| Коммит | Фиксация изменений в репозитории. Коммит сохраняет текущее состояние добавленных или измененных файлов вместе с описанием (сообщением), создавая новую точку в истории проекта. Каждый коммит имеет уникальный идентификатор (хэш). |
| Ветка | Параллельная линия разработки в репозитории. Ветки позволяют работать над разными задачами (например, новой функцией или исправлением ошибки) независимо, не затрагивая основную линию разработки. В Mercurial ветки именованные и сохраняются в истории. |
| Слияние | Объединение изменений из одной ветки в другую. Слияние используется для интеграции работы, выполненной в параллельных ветках, и требует разрешения конфликтов, если одни и те же файлы были изменены по-разному. |
| Тег | Метка, присваиваемая определенному коммиту для обозначения важных точек, таких как релиз версии (например, v1.0). Теги упрощают навигацию по истории проекта. |
| Рабочее дерево | Текущая копия файлов проекта на локальном компьютере, с которой работает пользователь. Это "живое" состояние файлов, которое может отличаться от последнего коммита. |
| Чейнджсет | Синоним коммита в терминологии Mercurial. Чейнджсет (changeset) — это набор изменений, зафиксированных в одном коммите, с уникальным идентификатором и метаданными. |
| Пулл/Пуш | Операции синхронизации с удаленным репозиторием. Пулл (pull) загружает изменения с сервера, а пуш (push) отправляет локальные изменения на сервер. |
| Хэш | Уникальный идентификатор чейнджсета (коммита), представленный длинной строкой символов (обычно сокращается до первых 12). Используется для точной ссылки на коммит. |
| Мерж (жаргон) | Слияние веток. Термин часто используется разработчиками вместо "слияние" в повседневной речи. |
| Хед (жаргон) | Последний коммит в ветке (head). В Mercurial может быть несколько хедов в одной ветке, если есть несмерженные изменения. |
| Роллбэк (жаргон) | Отмена последнего коммита или изменений с возвратом к предыдущему состоянию. Используется в контексте команды `hg rollback`. |

## Установка и настройка

Mercurial — это распределенная система контроля версий, которая позволяет управлять изменениями в проектах, обеспечивая надежное хранение истории и поддержку совместной работы. Установка и настройка Mercurial являются первыми шагами для начала работы, и этот раздел помогает новичкам быстро подготовить рабочую среду. Таблица ниже описывает процесс установки, базовую настройку и проверку окружения, чтобы пользователи могли уверенно приступить к созданию репозиториев. Эти команды и параметры задают основу для всех последующих операций, влияя на взаимодействие с локальными и удаленными репозиториями. Понимание их назначения критично для избежания ошибок, таких как неправильная конфигурация имени пользователя, что может нарушить идентификацию коммитов в команде.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|---------------|
| `hg version` | Проверка установленной версии Mercurial | Нет | ```bash<br># Проверка версии<br>hg version<br>```<br>```bash<br># Проверка с выводом только номера<br>hg version --quiet<br>``` | Ошибка: "hg: command not found"<br>Решение: Установить Mercurial (`sudo apt install mercurial` для Ubuntu).<br>Ошибка: Устаревшая версия<br>Решение: Обновить (`sudo apt upgrade mercurial`). | Подтверждает готовность системы к работе. | Требует установленного пакета Mercurial. |
| `hg config` | Настройка пользовательских параметров | `--edit` (открыть файл конфигурации), `username`, `ui.*` | ```bash<br># Установка имени и email<br>hg config --edit<br># В файле:<br>[ui]<br>username = Ivan Ivanov <ivan@example.com><br>```<br>```bash<br># Проверка конфигурации<br>hg config<br>```<br>```bash<br># Установка через команду<br>hg config --global ui.username "Ivan Ivanov <ivan@example.com>"<br>``` | Ошибка: "abort: no username supplied"<br>Решение: Указать `ui.username` в `~/.hgrc`.<br>Ошибка: Неправильный формат email<br>Решение: Использовать формат `Имя <email>`. | Задает идентификатор для коммитов. Влияет на все репозитории при глобальной настройке. | Взаимодействует с файлом `~/.hgrc` и командами коммита. |
| `hg help` | Вывод справки по командам | `<command>` (справка по команде) | ```bash<br># Общая справка<br>hg help<br>```<br>```bash<br># Справка по команде<br>hg help commit<br>``` | Ошибка: Неверная команда<br>Решение: Проверить синтаксис (`hg help <cmd>`). | Не влияет на систему, только предоставляет информацию. | Работает с любой командой Mercurial. |

**Важно запомнить**: Всегда настраивайте `ui.username` перед первым коммитом, чтобы избежать ошибок. Используйте `hg help` для быстрого доступа к документации.  
**Типичные ошибки**: Неправильная установка пути к Mercurial в PATH (решение: добавить `/usr/bin` в PATH), отсутствие прав на запись в `~/.hgrc` (решение: проверить права командой `chmod u+w ~/.hgrc`).

## Создание и управление репозиторием

Создание репозитория — это основа работы с Mercurial, позволяющая начать отслеживание изменений в проекте. Этот раздел охватывает команды для инициализации, клонирования и проверки состояния репозитория, что важно для новичков, только начинающих работу с системой контроля версий. Таблица ниже предоставляет полный обзор операций, их параметров и примеров, чтобы пользователи могли уверенно создавать и управлять репозиториями. Эти команды формируют базовую структуру проекта, влияя на последующие операции, такие как добавление файлов и создание коммитов. Понимание их работы помогает избежать проблем, например, клонирования неправильного репозитория или потери данных из-за неверного статуса.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|---------------|
| `hg init` | Создание нового локального репозитория | Нет | ```bash<br># Инициализация в текущей папке<br>hg init<br>```<br>```bash<br># Инициализация в указанной папке<br>hg init myproject<br>``` | Ошибка: Репозиторий уже существует<br>Решение: Проверить наличие `.hg` в папке (`ls -a`).<br>Ошибка: Нет прав на запись<br>Решение: Изменить права (`chmod u+w .`). | Создает папку `.hg` для хранения истории. | Взаимодействует с последующими командами (`hg add`, `hg commit`). |
| `hg clone` | Копирование удаленного репозитория | `<url>` (URL репозитория), `--noupdate` (без рабочего дерева) | ```bash<br># Клонирование<br>hg clone https://example.com/repo<br>```<br>```bash<br># Клонирование без рабочего дерева<br>hg clone --noupdate https://example.com/repo<br>```<br>```bash<br># Клонирование в папку<br>hg clone https://example.com/repo myrepo<br>``` | Ошибка: "abort: repository not found"<br>Решение: Проверить URL.<br>Ошибка: Нет соединения<br>Решение: Проверить сеть (`ping example.com`). | Создает локальную копию с полной историей. | Требует доступ к удаленному серверу. Влияет на `hg pull`. |
| `hg status` | Показ состояния рабочего дерева | `-A` (все файлы), `-m` (измененные), `-a` (добавленные) | ```bash<br># Проверка статуса<br>hg status<br>```<br>```bash<br># Только измененные файлы<br>hg status -m<br>``` | Ошибка: Ничего не отображается<br>Решение: Проверить, отслеживаются ли файлы (`hg add`). | Не изменяет систему, только показывает состояние. | Взаимодействует с `hg add`, `hg commit`. |

**Важно запомнить**: Используйте `hg status` перед коммитом, чтобы убедиться, что все нужные файлы добавлены.  
**Типичные ошибки**: Клонирование в уже существующий репозиторий (решение: удалить `.hg` или выбрать другую папку), попытка инициализации в неподходящей директории (решение: проверить права доступа).

## Работа с файлами и коммитами

Этот раздел посвящен управлению файлами в репозитории и фиксации изменений через коммиты. Для новичков важно понимать, как добавлять файлы под контроль версий, создавать коммиты и просматривать историю изменений. Таблица ниже описывает ключевые команды, их параметры и примеры, чтобы пользователи могли эффективно фиксировать изменения и управлять рабочим деревом. Эти операции напрямую влияют на историю репозитория и взаимодействуют с ветками и удаленными репозиториями, поэтому точное выполнение команд критично для предотвращения ошибок, таких как потеря изменений или конфликты.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|---------------|
| `hg add` | Добавление файлов под контроль | `<file>` (файл или папка), `--include` (паттерн) | ```bash<br># Добавление файла<br>hg add README.md<br>```<br>```bash<br># Добавление всех .py файлов<br>hg add --include "*.py"<br>``` | Ошибка: Файл уже отслеживается<br>Решение: Проверить статус (`hg status`).<br>Ошибка: Файл не найден<br>Решение: Убедиться, что файл существует. | Помечает файлы для следующего коммита. | Взаимодействует с `hg commit`. |
| `hg commit` | Фиксация изменений в репозитории | `-m` (сообщение), `-u` (пользователь) | ```bash<br># Коммит с сообщением<br>hg commit -m "Add README"<br>```<br>```bash<br># Коммит с указанием пользователя<br>hg commit -m "Update code" -u "Ivan <ivan@example.com>"<br>``` | Ошибка: "nothing changed"<br>Решение: Добавить файлы (`hg add`).<br>Ошибка: Нет сообщения<br>Решение: Указать `-m` или настроить редактор. | Создает новый чейнджсет в истории. | Влияет на `hg log`, `hg push`. |
| `hg log` | Просмотр истории коммитов | `-l` (лимит), `-b` (ветка), `--graph` (графический вид) | ```bash<br># Полная история<br>hg log<br>```<br>```bash<br># Последние 5 коммитов<br>hg log -l 5<br>```<br>```bash<br># История в графическом виде<br>hg log --graph<br>``` | Ошибка: Пустой вывод<br>Решение: Проверить наличие коммитов (`hg status`). | Не изменяет систему, только отображает историю. | Взаимодействует с `hg commit`, `hg update`. |
| `hg diff` | Показ различий между рабочим деревом и коммитом | `<file>` (конкретный файл), `-r` (ревизия) | ```bash<br># Различия для всех файлов<br>hg diff<br>```<br>```bash<br># Различия для файла<br>hg diff README.md<br>``` | Ошибка: Пустой вывод<br>Решение: Проверить изменения (`hg status`). | Не изменяет систему, только показывает различия. | Взаимодействует с `hg commit`, `hg revert`. |
| `hg revert` | Отмена изменений в файлах | `<file>` (файл), `--all` (все файлы) | ```bash<br># Отмена изменений в файле<br>hg revert README.md<br>```<br>```bash<br># Отмена всех изменений<br>hg revert --all<br>``` | Ошибка: Файл не отслеживается<br>Решение: Проверить статус (`hg status`). | Восстанавливает файлы до последнего коммита. | Взаимодействует с `hg status`, `hg diff`. |

**Важно запомнить**: Всегда проверяйте изменения с `hg diff` перед коммитом. Используйте понятные сообщения для `hg commit`.  
**Типичные ошибки**: Коммит без добавления файлов (решение: использовать `hg add`), потеря изменений при `hg revert` (решение: создать резервную копию).

## Управление ветками и слияниями

Ветки и слияния позволяют разработчикам работать над разными задачами параллельно, что особенно важно в командной разработке. Этот раздел помогает новичкам разобраться в создании, переключении и слиянии веток, а также в управлении тегами для обозначения важных точек в истории. Таблица ниже охватывает все ключевые операции, включая параметры, примеры и типичные ошибки, чтобы пользователи могли уверенно управлять ветками и избегать проблем, таких как конфликты при слиянии. Эти команды влияют на структуру репозитория и требуют осторожного использования для поддержания чистой истории.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|---------------|
| `hg branch` | Создание новой ветки | `<branch-name>` (имя ветки) | ```bash<br># Создание ветки<br>hg branch feature-x<br>```<br>```bash<br># Проверка текущей ветки<br>hg branch<br>``` | Ошибка: Ветка уже существует<br>Решение: Выбрать другое имя.<br>Ошибка: Нельзя создать без коммита<br>Решение: Создать коммит. | Создает новую ветку в истории. | Взаимодействует с `hg commit`, `hg update`. |
| `hg update` | Переключение на ветку или ревизию | `<branch-name>` (ветка), `-r` (ревизия) | ```bash<br># Переключение на ветку<br>hg update feature-x<br>```<br>```bash<br># Переключение на ревизию<br>hg update -r 10<br>``` | Ошибка: Несохраненные изменения<br>Решение: Сохранить (`hg commit`) или отменить (`hg revert`). | Изменяет рабочее дерево до указанного состояния. | Взаимодействует с `hg branch`, `hg merge`. |
| `hg merge` | Слияние ветки в текущую | `<branch-name>` (ветка) | ```bash<br># Слияние ветки<br>hg merge feature-x<br>```<br>```bash<br># Слияние с разрешением конфликтов<br>hg merge feature-x<br>hg resolve --all<br>hg commit<br>``` | Ошибка: Конфликт слияния<br>Решение: Разрешить конфликты (`hg resolve`) и закоммитить.<br>Ошибка: Неверная ветка<br>Решение: Проверить текущую ветку (`hg branch`). | Объединяет изменения, создавая новый чейнджсет. | Взаимодействует с `hg commit`, `hg resolve`. |
| `hg branches` | Показ списка веток | Нет | ```bash<br># Список веток<br>hg branches<br>``` | Ошибка: Пустой список<br>Решение: Создать ветку (`hg branch`). | Не изменяет систему, только показывает ветки. | Взаимодействует с `hg branch`, `hg update`. |
| `hg tag` | Создание тега для коммита | `<tag-name>` (имя тега), `-r` (ревизия) | ```bash<br># Создание тега<br>hg tag v1.0<br>```<br>```bash<br># Тег для ревизии<br>hg tag -r 10 v1.0<br>``` | Ошибка: Тег уже существует<br>Решение: Удалить (`hg tag --remove`) или выбрать новое имя. | Добавляет метку в историю. | Взаимодействует с `hg log`, `hg push`. |

**Важно запомнить**: Всегда коммитьте изменения перед слиянием. Используйте `hg resolve` для разрешения конфликтов.  
**Типичные ошибки**: Слияние без обновления рабочего дерева (решение: выполнить `hg update`), создание тега без коммита (решение: закоммитить изменения).

## Работа с удаленными репозиториями

Синхронизация с удаленными репозиториями позволяет обмениваться изменениями между разработчиками. Этот раздел помогает новичкам освоить загрузку и отправку изменений, а также настройку удаленных репозиториев. Таблица ниже описывает команды для работы с удаленными репозиториями, их параметры и примеры, чтобы пользователи могли эффективно сотрудничать в команде. Эти операции критично влияют на совместную работу, и неправильное использование может привести к конфликтам или потере данных, поэтому важно понимать их взаимодействие с локальным репозиторием.

| Команда | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|---------|------------|-----------|---------|------------------|---------|---------------|
| `hg pull` | Загрузка изменений с удаленного репозитория | `<url>` (URL), `-u` (обновить рабочее дерево) | ```bash<br># Загрузка изменений<br>hg pull<br>```<br>```bash<br># Загрузка и обновление<br>hg pull -u<br>``` | Ошибка: "repository not found"<br>Решение: Проверить URL в `.hg/hgrc`.<br>Ошибка: Конфликты<br>Решение: Выполнить `hg merge`. | Обновляет локальную историю. | Взаимодействует с `hg merge`, `hg update`. |
| `hg push` | Отправка изменений в удаленный репозиторий | `<url>` (URL), `-f` (принудительно) | ```bash<br># Отправка изменений<br>hg push<br>```<br>```bash<br># Принудительная отправка<br>hg push -f<br>``` | Ошибка: "push creates new remote heads"<br>Решение: Слить ветки (`hg merge`).<br>Ошибка: Нет прав<br>Решение: Проверить доступ. | Обновляет удаленный репозиторий. | Взаимодействует с `hg commit`, `hg pull`. |
| `hg paths` | Показ путей к удаленным репозиториям | Нет | ```bash<br># Список путей<br>hg paths<br>``` | Ошибка: Пустой список<br>Решение: Настроить путь в `.hg/hgrc`. | Не изменяет систему, только показывает пути. | Взаимодействует с `hg pull`, `hg push`. |

**Важно запомнить**: Всегда выполняйте `hg pull` перед `hg push`, чтобы избежать конфликтов.  
**Типичные ошибки**: Пуш без коммита (решение: закоммитить изменения), неправильный URL репозитория (решение: проверить `.hg/hgrc`).

## Продвинутые сценарии

Этот раздел охватывает более сложные сценарии использования Mercurial, такие как автоматизация, интеграция и управление безопасностью, которые полезны для опытных новичков. Таблица ниже описывает команды и подходы для продвинутых задач, включая примеры скриптов и настройки, чтобы пользователи могли оптимизировать свою работу. Эти операции требуют глубокого понимания системы и могут существенно повлиять на производительность и безопасность репозитория, поэтому важно учитывать их взаимодействие с другими командами.

| Команда/Сценарий | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|------------------|------------|-----------|---------|------------------|---------|---------------|
| `hg hook` | Настройка хуков для автоматизации | `commit`, `push` (тип хука) | ```bash<br># Хук для проверки перед коммитом<br>[hooks]<br>commit = python:check_code.py<br>```<br>```bash<br># Хук для уведомлений<br>[hooks]<br>push = notify.sh<br>``` | Ошибка: Хук не выполняется<br>Решение: Проверить права на скрипт (`chmod +x`).<br>Ошибка: Синтаксическая ошибка<br>Решение: Проверить скрипт. | Автоматизирует задачи, улучшая контроль. | Взаимодействует с `hg commit`, `hg push`. |
| `hg strip` | Удаление чейнджсетов (с осторожностью) | `<rev>` (ревизия), `-k` (сохранение изменений) | ```bash<br># Удаление коммита<br>hg strip 10<br>```<br>```bash<br># Удаление с сохранением<br>hg strip -k 10<br>``` | Ошибка: "cannot strip pushed changes"<br>Решение: Убедиться, что коммит не отправлен.<br>Ошибка: Потеря данных<br>Решение: Создать бэкап (`hg export`). | Удаляет историю, изменяя репозиторий. | Взаимодействует с `hg log`, `hg push`. |
| `hg share` | Совместное использование репозитория | `<path>` (путь) | ```bash<br># Создание общего репозитория<br>hg share /path/to/repo shared<br>``` | Ошибка: Нет прав<br>Решение: Проверить права доступа.<br>Ошибка: Конфликты<br>Решение: Синхронизировать перед использованием. | Создает связанный репозиторий. | Взаимодействует с `hg pull`, `hg push`. |

**Важно запомнить**: Используйте `hg strip` только на локальных коммитах. Настраивайте хуки с учетом безопасности.  
**Типичные ошибки**: Неправильная настройка хуков (решение: проверить синтаксис в `.hg/hgrc`), потеря данных при `hg strip` (решение: всегда создавать бэкап).

## Конфигурационные параметры

| Параметр | Описание |
|----------|----------|
| `[ui] username = Имя <email>` | # Задает имя и email для коммитов. Обязательно для идентификации автора. |
| `[ui] editor = nano` | # Указывает редактор для сообщений коммитов. Замените nano на vim, emacs и т.д. |
| `[paths] default = <url>` | # Задает URL удаленного репозитория по умолчанию для `hg pull` и `hg push`. |
| `[hooks] commit = <script>` | # Указывает скрипт для выполнения после коммита. Например, проверка кода. |
| `[merge-tools] kdiff3` | # Настройка инструмента для разрешения конфликтов (например, kdiff3, meld). |
| `[extensions] strip =` | # Включает расширение strip для удаления чейнджсетов. Требует осторожности. |
| `[web] allow-push = *` | # Разрешает пуш для всех пользователей на веб-сервере. Используйте с осторожностью. |
| `[diff] git = true` | # Включает git-совместимый формат для `hg diff`. Полезно для интеграции. |
