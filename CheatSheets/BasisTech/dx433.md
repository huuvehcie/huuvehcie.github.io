# Базис.DynamiX

## 1. Назначение продукта

Программное обеспечение "Базис.DynamiX" версии 4.3.0 предназначено для создания и управления частной облачной инфраструктурой, а также для серверной виртуализации и виртуализации рабочих мест (VDI). Продукт включен в Единый реестр российских программ для электронных вычислительных машин и баз данных.

**Задачи, которые решает Базис.DynamiX:**

* **Серверная виртуализация:** эффективное использование вычислительных ресурсов.
* **Виртуализация рабочих мест (VDI):** предоставление удаленных рабочих мест.
* **Построение облачной инфраструктуры:** создание и управление собственными облаками.
* **Автоматизация:** упрощение управления IT-ресурсами.

**Категория/тип ПО:**
Базис.DynamiX относится к классу **платформ виртуализации и облачных вычислений**.

## 2. Общая архитектура

Архитектура платформы Базис.DynamiX версии 4.3.0 включает логические и функциональные компоненты, а также оборудование и сетевую инфраструктуру.

### Логические и функциональные компоненты

1.  **Менеджер сервисов (Services Manager):**
    * Является центральным компонентом, управляющим всеми системными и прикладными сервисами.
    * Отвечает за предоставление инфраструктуры как услуги (IaaS - Infrastructure as a Service).
    * Реализован в виде кластера Kubernetes, что обеспечивает отказоустойчивость.
    * Позволяет автоматизировать рутинные операции, такие как создание ВМ, выделение ресурсов, резервное копирование и восстановление.
    * Использует базу данных для хранения данных о конфигурации и состоянии системы.

2.  **Диспетчер задач (Task Manager):**
    * Отвечает за постановку, выполнение и мониторинг асинхронных задач.
    * Обеспечивает устойчивость и стабильность работы системы при выполнении длительных операций.

3.  **Аутентификация и Авторизация:**
    * Система безопасности, интегрированная с **Базис. Decs30** и **Базис. Virtual Security**.
    * Обеспечивает разграничение доступа пользователей к ресурсам и функциям на основе ролей.

4.  **Службы мониторинга и логирования:**
    * Собирают метрики производительности и системные события.
    * Журналирование событий позволяет отслеживать активность и выявлять проблемы.

### Оборудование

* **Контроллеры:** Физические серверы, на которых размещаются основные управляющие компоненты системы (Control Plane). Они не выполняют рабочие нагрузки ВМ.
* **Вычислительные узлы (Compute Nodes):** Физические серверы, на которых запускаются виртуальные машины. Каждый узел содержит **гипервизор**.
* **СХД (Система хранения данных):** Предназначены для хранения дисков виртуальных машин, образов и других данных. Поддерживаются различные типы СХД, такие как **локальные СХД** и **файловые СХД**.
* **Коммутаторы:** Сетевое оборудование, обеспечивающее связь между всеми компонентами системы, а также связь виртуальных машин с внешним миром.

### Сеть

* **Физическая сеть:** Сеть, объединяющая контроллеры, вычислительные узлы и СХД.
* **Логическая сеть:** Виртуальные сети, создаваемые внутри Базис.DynamiX для изоляции трафика виртуальных машин. Поддерживает **виртуальные маршрутизаторы (VNF-DEV)** и **статические маршруты**.

### Уровни

* **Уровень управления (Control Plane):** Обеспечивается контроллерами и менеджером сервисов.
* **Уровень вычислений (Compute Plane):** Обеспечивается вычислительными узлами, на которых работают гипервизоры.
* **Уровень хранения (Storage Plane):** Обеспечивается СХД.
* **Уровень сети (Network Plane):** Обеспечивается коммутаторами и виртуальной сетевой инфраструктурой.

## 3. Основные функции

Базис.DynamiX предоставляет следующие ключевые функции:

* **Управление виртуальными машинами (ВМ):**
    * **Создание, запуск, остановка, перезагрузка, удаление ВМ.**
    * **Изменение параметров ВМ:** настройка **vCPU** (виртуальных ядер процессора), **vRAM** (виртуальной оперативной памяти), размера **виртуальных дисков**.
    * **Миграция ВМ:** перемещение ВМ между вычислительными узлами.
    * **Снимки ВМ (Snapshots):** создание точек восстановления состояния ВМ.
    * **Поддержка образов ВМ:** использование готовых шаблонов операционных систем для быстрого развертывания.
    * **Консоль ВМ:** удаленный доступ к графической или текстовой консоли виртуальной машины.
* **Управление вычислительными ресурсами:**
    * **Добавление и удаление вычислительных узлов.**
    * **Мониторинг состояния узлов.**
* **Управление хранилищем данных:**
    * **Создание и управление пулами хранения.**
    * **Выделение дисков для ВМ.**
    * **Управление образами дисков.**
* **Управление сетевыми функциями:**
    * **Создание и управление виртуальными сетями (VINS):** включая настройки **маршрутизации** и **сетевых правил**.
    * **Настройка виртуальных маршрутизаторов (VNF-DEV).**
    * **Управление плавающими IP-адресами (Floating IPs).**
    * **Поддержка DPDK (Data Plane Development Kit)** для высокопроизводительных сетевых операций.
* **Управление пользователями и правами доступа:**
    * **Создание и управление аккаунтами пользователей и групп.**
    * **Ролевая модель доступа (RBAC):** Администратор, Пользователь, Оператор.
    * **Мультитенантность:** поддержка нескольких независимых арендаторов (аккаунтов) на одной платформе.
* **Мониторинг и отчетность:**
    * Сбор **метрик производительности** ВМ и физических серверов.
    * **Система оповещений.**
    * **Журналирование событий.**
* **Интеграция с внешними системами:**
    * Предоставление **API-ADM** (Application Programming Interface для администратора) и **API-USER** (API для пользователя).
    * Интеграция с системами аутентификации **Базис. Decs30** и **Базис. Virtual Security**.

## 4. Терминология и сокращения

* **Аккаунт (Account):** Логическая единица в Базис.DynamiX, представляющая собой арендатора или группу пользователей с общими ресурсами и правами.
* **API (Application Programming Interface):** Интерфейс для программного взаимодействия с системой. Различают **API-ADM** (администратора) и **API-USER** (пользователя).
* **API-ADM:** Руководство по использованию API администратора.
* **API-USER:** Руководство по использованию API пользователя.
* **ВМ (VM):** Виртуальная машина.
* **VDI (Virtual Desktop Infrastructure):** Инфраструктура виртуальных рабочих столов.
* **VINS (Virtual Internal Network Service):** Виртуальная внутренняя сеть.
* **VNF-DEV (Virtual Network Function Device):** Виртуальное сетевое устройство, например, виртуальный маршрутизатор.
* **vCPU (Virtual Central Processing Unit):** Виртуальный процессор, выделяемый для ВМ.
* **vRAM (Virtual Random Access Memory):** Виртуальная оперативная память, выделяемая для ВМ.
* **Гео-распределенный кластер:** Размещение частей кластера в разных географических точках для повышения отказоустойчивости.
* **Гипервизор (Hypervisor):** Программное обеспечение, позволяющее запускать несколько виртуальных машин на одном физическом сервере.
* **ГОСТЕХ стандарт:** Стандарт, указывающий на соответствие государственным техническим требованиям Российской Федерации.
* **DPDK (Data Plane Development Kit):** Набор библиотек и драйверов для ускорения обработки сетевых пакетов.
* **Huge Pages (Большие страницы памяти):** Специальный режим использования памяти, который может повысить производительность для некоторых приложений, работающих в ВМ.
* **IaaS (Infrastructure as a Service):** Модель облачных вычислений, при которой пользователю предоставляется инфраструктура (виртуальные машины, сети, хранилища) как услуга.
* **Контроллер (Controller):** Управляющий узел, координирующий работу платформы.
* **Kubernetes (K8s):** Открытая система для автоматизации развёртывания, масштабирования и управления контейнерными приложениями. Используется для компонентов Базис.DynamiX, таких как **osis** и **portal**.
* **`kubectl`:** Утилита командной строки для управления кластерами Kubernetes.
* **Логирование (Logging):** Запись системных событий и действий в журналы.
* **Миграция "на лету" (Live Migration):** Перемещение запущенной ВМ без прерывания ее работы.
* **Мультитенантность (Multi-tenancy):** Способность одной копии программного обеспечения обслуживать множество независимых пользователей или организаций, обеспечивая изоляцию их данных и ресурсов.
* **Образ ВМ (VM Image):** Шаблон ВМ с предустановленной операционной системой.
* **`osis`:** Один из ключевых компонентов Базис.DynamiX, является ядром системы (модуль osis).
* **Плавающий IP-адрес (Floating IP):** IP-адрес, который может быть динамически назначен виртуальной машине и доступен извне.
* **Портал (Portal):** Веб-интерфейс пользователя и администратора Базис.DynamiX.
* **Пул хранения (Storage Pool):** Логическое объединение физических ресурсов хранения данных.
* **Регион (Region):** Географически или логически обособленная часть облачной инфраструктуры.
* **Реплика (Replica):** Копия компонента системы, используемая для повышения отказоустойчивости и масштабируемости.
* **РГ (Ресурсная группа, Resource Group):** Логическое объединение виртуальных ресурсов внутри аккаунта.
* **Серверная виртуализация (Server Virtualization):** Технология, позволяющая запускать несколько операционных систем на одном физическом сервере.
* **СЖЦ (Система Жизненного Цикла):** Возможно, относится к управлению жизненным циклом ВМ.
* **СХД (Система хранения данных):** Аппаратное или программное обеспечение для хранения данных.
* **Хранилище:** Место для хранения данных.
* **Хранилище SHARED:** Тип СХД, при котором диски доступны нескольким узлам.
* **Ядро системы (`osis`):** Центральный управляющий компонент.

## 5. Принципы работы

Базис.DynamiX функционирует на основе следующих принципов:

* **Абстракция аппаратного обеспечения:** Система предоставляет виртуальные ресурсы, скрывая детали физического оборудования.
* **Централизованное управление:** Управление всей инфраструктурой осуществляется через **веб-портал** или **API**.
* **Распределение ресурсов:** Ресурсы (vCPU, vRAM) динамически распределяются между **виртуальными машинами** на **вычислительных узлах**.
* **Изоляция:** **Виртуальные машины** и **виртуальные сети** изолированы друг от друга для обеспечения безопасности и стабильности.
* **Программная определяемость:** Многие функции реализованы программно для гибкости и масштабируемости.
* **Автоматизация:** Возможность автоматизации операций через **API** и встроенные механизмы.
* **Отказоустойчивость и высокая доступность:**
    * **Кластеризация** ключевых компонентов (**контроллеров**).
    * **Миграция ВМ** для обеспечения непрерывности работы при сбоях узлов.
    * **Избыточность реплик** управляющих сервисов, таких как **osis** и **portal**, в кластере **Kubernetes**.
* **Обработка данных:** Запросы пользователей обрабатываются **контроллерами**, которые взаимодействуют с **базой данных** и дают команды **вычислительным узлам**.
* **Обработка ошибок, устойчивость:** Система мониторит состояние компонентов, регистрирует события в **журналах (логах)** и пытается автоматически восстанавливаться при сбоях (например, увеличен **TIMEOUT** для **jumpscript** **shared\_check\_mt\_node**).

## 6. Безопасность

Базис.DynamiX включает следующие меры безопасности:

* **Изоляция ВМ:** **Виртуальные машины** полностью изолированы друг от друга на уровне **гипервизора**.
* **Контроль доступа:**
    * **Аутентификация:** Подтверждение личности пользователя, возможно, через **Базис. Decs30** или **Базис. Virtual Security**.
    * **Авторизация:** Определение разрешенных действий на основе **ролей** и принадлежности к **аккаунту** или **ресурсной группе**.
    * **Принцип наименьших привилегий:** Предоставление только необходимых прав.
* **Управление безопасностью сети:**
    * Использование **виртуальных сетей (VINS)** для разделения трафика.
    * Возможность настройки **сетевых правил** и **статических маршрутов**.
* **Защита данных на хранении:**
    * Ограничение создания дисков и образов в **СХД/пулах хранения**, недоступных для **аккаунта**.
* **Журналирование событий:** Все значимые действия и события записываются в **журналы**, что позволяет проводить аудит и отслеживать активность.
* **Учет Huge Pages:** Если **Huge Pages** включены у ВМ (**hugepages: true**) на **dpdk узле**, они включаются в **shared режиме**, что может влиять на изоляцию памяти.

**Соответствие требованиям ФСТЭК (подразумеваемое):**
Документы указывают на то, что продукт соответствует **ГОСТЕХ стандарту** и используется в **Инфраструктуре электронного правительства**, что подразумевает соответствие требованиям **Федеральной службы по техническому и экспортному контролю (ФСТЭК)** к продуктам для виртуализации и облачных вычислений. Это включает:
* Обеспечение доверенной среды.
* Разделение прав доступа.
* Контроль целостности.
* Регистрация и аудит событий безопасности.
* Защита от несанкционированного доступа.
* Идентификация и аутентификация.

## 7. Управление и настройка

Управление и настройка Базис.DynamiX осуществляется через:

* **Веб-портал:** Основной графический интерфейс для администраторов и пользователей. Предоставляет доступ к управлению **ВМ**, **сетями**, **СХД**, **аккаунтами** и **ресурсными группами**. Обновление данных в таблицах на страницах со списками объектов происходит после успешного запроса на создание объекта.
* **API (Application Programming Interface):**
    * **API-ADM:** Для программного управления всей инфраструктурой. Документация доступна в интерактивном формате **Swagger UI**.
    * **API-USER:** Для программного управления ресурсами конкретного **аккаунта**. Документация также доступна через **Swagger UI**.
    * API позволяет выполнять **асинхронные задачи** (группа `task`).
* **Конфигурационные файлы:** Для изменения количества **реплик** компонентов **osis** и **portal** в кластере **Kubernetes** необходимо редактировать файл `system-config` с помощью команды `kubectl edit cm system-config`. Параметры `portal_replicas` и `osis_replicas` указываются в секции `environment`.

## 8. Особенности интеграции

Базис.DynamiX поддерживает интеграцию с внешними системами:

* **RESTful API:** Оба **API (API-ADM** и **API-USER)** реализованы по принципу REST, используя HTTP/HTTPS и JSON, что упрощает программное взаимодействие.
* **Интеграция с системами аутентификации:** Поддерживается авторизация через **Базис. Decs30** и **Базис. Virtual Security**.
* **`Curl`:** Утилита командной строки для передачи данных с помощью синтаксиса URL, что позволяет тестировать API-методы.
* **`Request URL`, `Response Body`, `Response Code`, `Response Headers`:** Информация, предоставляемая при выполнении API-запросов, для отладки и анализа.

## 9. Ограничения и особенности

* **Huge Pages:** При запуске ВМ на **dpdk узле**, если **Huge pages** включены у ВМ (`hugepages: true`), они включаются в **shared режиме**.
* **TIMEOUT для jumpscript:** Для **jumpscript** **shared\_check\_mt\_node** на **agentcontroller** увеличен **TIMEOUT**.
* **Ограничения на создание дисков/образов:** Запрещено создавать диски и образы в **СХД/пулах хранения**, недоступных для **аккаунта**.
* **СХД SHARED:** Исправлены сбои при запуске служб блокировки **LVM (lvmlockd)** и управлением блокировкой **sanlock** для **СХД SHARED**.
* **Отключение служб в инсталляторе:** В инсталлятор для ОС Ubuntu 22 и Ubuntu 24 добавлено отключение служб `apt-daily.service`, `apt-daily.timer`, `apt-daily-upgrade.service`, `apt-daily-upgrade.timer`, `unattended-upgrades.service`.
* **Обновление данных на портале:** После успешного запроса на создание объекта, отправляется новый запрос на обновление данных на страницах со списками **аккаунтов**, **РГ (Ресурсных групп)**, **ВМ**, **внутренних сетей** и других объектов.
* **Масштабирование реплик:** Для изменения количества **реплик** для **osis** и **portal** во время работы кластера используются команды `kubectl scale --replicas <количество реплик> deployment osis` и `kubectl scale --replicas <количество реплик> deployment portal`. Также количество реплик должно быть указано в конфигурационном файле `system-config` (`portal_replicas`, `osis_replicas`) для сохранения настроек после обновления кластера.
* **Поддерживаемые ОС:** Astra Linux, Альт, Ubuntu 18.04/22/24.

## 10. Заключение

"Базис.DynamiX" версии 4.3.0 является российской платформой для построения и управления облачной инфраструктурой, предназначенной для серверной виртуализации и виртуализации рабочих мест (VDI). Она предлагает централизованное управление через веб-портал и API, обеспечивая автоматизацию, мультитенантность и механизмы безопасности, включая изоляцию ресурсов и ролевую модель доступа. Система соответствует ГОСТЕХ стандарту и используется в Инфраструктуре электронного правительства.

Продукт полезен для крупных корпораций, государственных организаций, IT-департаментов, разработчиков и провайдеров услуг, заинтересованных в эффективном использовании вычислительных ресурсов и импортозамещении.
