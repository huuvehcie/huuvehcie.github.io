

## Основные компоненты Jenkins:

| Компонент | Описание |
| --- | --- |
| Jenkins Master | Центральный сервер Jenkins, который управляет всем процессом автоматизации. Он координирует задачи, запускает агентов и управляет плагинами. |
| Jenkins Agent (Node) | Агенты Jenkins выполняют задачи, назначенные мастером. Они могут быть физическими или виртуальными машинами, контейнерами или удаленными узлами. |
| Плагины (Plugins) | Плагины расширяют функциональность Jenkins, добавляя новые возможности, интеграции с инструментами и поддержку различных технологий. |
| Задания (Jobs/Projects) | Задания представляют собой автоматизированные процессы, которые Jenkins может выполнять. Они могут включать сборку, тестирование, развертывание и другие задачи. |
| Пайплайны (Pipelines) | Пайплайны - это последовательность шагов, которые определяют процесс непрерывной интеграции и доставки (CI/CD). Они могут быть созданы с помощью синтаксиса Jenkins Pipeline или графического интерфейса. |
| Рабочее пространство (Workspace) | Рабочее пространство - это каталог на узле Jenkins, где выполняется задание. Он используется для хранения временных файлов и результатов сборки. |

## Основные термины Jenkins:

| Термин | Описание |
| --- | --- |
| Непрерывная интеграция (Continuous Integration - CI) | Практика объединения изменений в коде разработчиков в общую ветку несколько раз в день, обеспечивая раннее обнаружение конфликтов и проблем. |
| Непрерывная доставка (Continuous Delivery - CD) | Расширение CI, которое включает автоматизацию процесса развертывания приложений в различных средах, таких как тестирование, подготовка и производство. |
| Непрерывное развертывание (Continuous Deployment) | Автоматизация полного процесса выпуска программного обеспечения, включая развертывание в производственной среде без ручного вмешательства. |
| Build (Сборка) | Процесс компиляции, тестирования и упаковки исходного кода в готовое к развертыванию приложение. |
| Build Pipeline (Пайплайн сборки) | Последовательность шагов, определяющих процесс сборки, тестирования и развертывания приложения. |
| Build Trigger (Триггер сборки) | Событие или условие, которое запускает сборку, например, изменение в системе контроля версий или расписание. |
| Build Artifact (Артефакт сборки) | Результат сборки, такой как скомпилированный код, архив или исполняемый файл. |

## Основные операции Jenkins:

| Операция | Описание |
| --- | --- |
| Создание задания (Create Job) | Создание нового задания в Jenkins, которое может быть настроено для выполнения определенных задач. |
| Запуск задания (Run Job) | Запуск задания вручную или по триггеру для выполнения определенных задач. |
| Конфигурация задания (Configure Job) | Настройка параметров задания, включая пайплайн, параметры сборки, уведомления и другие настройки. |
| Просмотр журнала сборки (View Build History) | Просмотр журнала предыдущих сборок, включая их статус, длительность и результаты. |
| Управление агентами (Manage Agents) | Добавление, удаление и настройка агентов Jenkins для выполнения задач. |
| Установка плагинов (Install Plugins) | Установка и обновление плагинов для расширения функциональности Jenkins. |
| Управление пользователями (User Management) | Управление доступом и разрешениями пользователей Jenkins. |
| Jenkins CLI | Использование командной строки Jenkins для выполнения задач и управления Jenkins через командный интерфейс. |

## Команды Jenkins CLI:

| Команда | Описание |
| --- | --- |
| jenkins-cli create-job | Создает новое задание в Jenkins на основе шаблона или XML-файла. |
| jenkins-cli build | Запускает сборку заданного задания. |
| jenkins-cli console | Открывает консоль Jenkins для взаимодействия с сервером в режиме реального времени. |
| jenkins-cli copy-job | Копирует существующее задание в новое задание с возможностью изменения его настроек. |
| jenkins-cli delete-job | Удаляет заданное задание из Jenkins. |
| jenkins-cli disable-job | Отключает заданное задание, предотвращая его запуск. |
| jenkins-cli enable-job | Включает заданное задание, позволяя его запуск. |
| jenkins-cli list-jobs | Отображает список всех заданий в Jenkins. |
| jenkins-cli plugin | Управление плагинами, включая установку, обновление и удаление. |
| jenkins-cli restart | Перезапускает сервер Jenkins. |
| jenkins-cli safe-restart | Перезапускает Jenkins, ожидая завершения текущих сборок. |
| jenkins-cli safe-shutdown | Безопасно выключает Jenkins, ожидая завершения текущих сборок. |
| jenkins-cli version | Отображает версию установленного Jenkins. |

---

## 1. Основы Jenkins Pipeline

**Контекст**: Pipeline — автоматизированный процесс CI/CD, описываемый в `Jenkinsfile` (декларативный или скриптовой синтаксис). Позволяет управлять сборкой, тестированием, развертыванием.

### Таблица 1: Основные элементы Pipeline

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `pipeline` | Корневой блок для декларативного Pipeline | `agent`, `stages`, `post` | ```groovy<br>pipeline {<br>  agent any<br>  stages {<br>    stage('Build') {<br>      steps {<br>        sh 'echo Building'<br>      }<br>    }<br>  }<br>}<br>```<br> ```groovy<br>pipeline {<br>  agent { docker 'node:14' }<br>  stages { ... }<br>}<br>``` | **Ошибка**: "No agent specified".<br>**Решение**: Укажите `agent any` или конкретный агент.<br>**Ошибка**: Синтаксическая ошибка.<br>**Решение**: Проверьте отступы и структуру в `Jenkinsfile`. | Определяет структуру всего Pipeline. | Требует настройки агентов и плагинов (Docker, Kubernetes). |
| `agent` | Указывает, где выполняется Pipeline | `any`, `none`, `docker`, `label` | ```groovy<br>agent any // Любой доступный агент<br>```<br> ```groovy<br>agent { label 'linux' } // Агент с меткой<br>```<br> ```groovy<br>agent { docker { image 'maven:3.8' } } // Docker-контейнер<br>``` | **Ошибка**: "No agent with label".<br>**Решение**: Проверьте метки в настройках агентов.<br>**Ошибка**: Docker не запускается.<br>**Решение**: Убедитесь, что плагин Docker установлен и Docker доступен. | Влияет на выбор исполнителя (узел, контейнер). | Интеграция с Docker, Kubernetes, настройка узлов. |
| `stages` | Список этапов выполнения | Список `stage` | ```groovy<br>stages {<br>  stage('Test') {<br>    steps { sh 'make test' }<br>  }<br>}<br>``` | **Ошибка**: Пустой `stages`.<br>**Решение**: Добавьте хотя бы один `stage`. | Определяет последовательность задач. | Зависит от `agent` и `steps`. |
| `steps` | Действия внутри этапа | `sh`, `bat`, `echo`, плагины | ```groovy<br>steps {<br>  sh 'npm install' // Linux<br>  bat 'dir' // Windows<br>}<br>``` | **Ошибка**: "sh not found" на Windows.<br>**Решение**: Используйте `bat` для Windows. | Выполняет команды в контексте агента. | Требует совместимости с ОС агента. |

**Важно запомнить**:
- `Jenkinsfile` хранится в репозитории (SCM) или создается вручную.
- Декларативный синтаксис проще для новичков, скриптовой — для сложной логики.
- Совместимость: Linux, Windows, macOS; Docker требует плагина.

**Типичные ошибки**:
- Неправильные отступы в `Jenkinsfile` → используйте валидатор синтаксиса.
- Отсутствие плагинов → установите необходимые плагины через UI Jenkins.

---

## 2. Настройка и запуск Pipeline

**Контекст**: Настройка Pipeline включает создание `Jenkinsfile`, интеграцию с SCM (Git), настройку агентов и запуск через Jenkins UI.

### Таблица 2: Настройка Pipeline

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `scm` | Интеграция с системой контроля версий | `git`, `branch`, `credentialsId` | ```groovy<br>steps {<br>  git url: 'https://github.com/user/repo.git', branch: 'main'<br>}<br>```<br> ```groovy<br>checkout scm // Автоматическая загрузка из SCM<br>``` | **Ошибка**: "Authentication failed".<br>**Решение**: Настройте `credentialsId` в Jenkins.<br>**Ошибка**: "Branch not found".<br>**Решение**: Проверьте имя ветки. | Загружает код для Pipeline. | Требует плагина Git и настроенных учетных данных. |
| `environment` | Определение переменных окружения | Ключ-значение | ```groovy<br>environment {<br>  APP_ENV = 'prod'<br>  CREDENTIALS = credentials('my-creds')<br>}<br>``` | **Ошибка**: Переменная не найдена.<br>**Решение**: Проверьте синтаксис и область видимости. | Устанавливает переменные для всех этапов. | Используется в `steps`, плагинах. |
| `post` | Действия после выполнения Pipeline | `always`, `success`, `failure` | ```groovy<br>post {<br>  always { echo 'Cleanup' }<br>  failure { mail to: 'team@example.com' }<br>}<br>``` | **Ошибка**: Уведомление не отправлено.<br>**Решение**: Настройте SMTP в Jenkins. | Выполняет финальные действия. | Интеграция с плагинами (Email, Slack). |

**Важно запомнить**:
- SCM требует настройки плагинов (Git, GitHub).
- Переменные окружения чувствительны к области видимости.
- Совместимость: Git работает на всех ОС; Windows требует `bat` для команд.

**Типичные ошибки**:
- Неправильный URL репозитория → проверьте доступность и права.
- Отсутствие учетных данных → добавьте их в Jenkins Credentials.

---

## 3. Продвинутые сценарии

**Контекст**: Продвинутые сценарии включают интеграции (Docker, Kubernetes), безопасность, параллельное выполнение и автоматизацию.

### Таблица 3: Продвинутые элементы Pipeline

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `parallel` | Параллельное выполнение этапов | `stage` внутри `parallel` | ```groovy<br>stages {<br>  stage('Parallel') {<br>    parallel {<br>      stage('Test1') { steps { sh 'test1.sh' } }<br>      stage('Test2') { steps { sh 'test2.sh' } }<br>    }<br>  }<br>}<br>``` | **Ошибка**: Этапы конфликтуют.<br>**Решение**: Используйте разные агенты или `lock`. | Ускоряет выполнение. | Требует достаточных ресурсов агентов. |
| `withCredentials` | Безопасное использование учетных данных | `credentialsId`, `variable` | ```groovy<br>withCredentials([usernamePassword(credentialsId: 'my-creds', usernameVariable: 'USER', passwordVariable: 'PASS')]) {<br>  sh 'curl -u $USER:$PASS https://api'<br>}<br>``` | **Ошибка**: "Credentials not found".<br>**Решение**: Проверьте ID учетных данных. | Защищает чувствительные данные. | Интеграция с Jenkins Credentials. |
| `lock` | Блокировка ресурсов | `resource` | ```groovy<br>lock('db-resource') {<br>  sh 'update-db.sh'<br>}<br>``` | **Ошибка**: Дедлок.<br>**Решение**: Уменьшите время блокировки. | Предотвращает конфликты. | Требует плагина Lockable Resources. |

**Важно запомнить**:
- Параллельное выполнение требует мощных агентов.
- Безопасность: Храните учетные данные в Jenkins, избегайте их в коде.
- Совместимость: `lock` требует плагина; Docker/Kubernetes — соответствующих агентов.

**Типичные ошибки**:
- Перегрузка агентов при `parallel` → ограничьте количество параллельных задач.
- Утечка учетных данных → используйте `withCredentials`.

---

## 4. Оптимизация и автоматизация

**Контекст**: Оптимизация Pipeline включает минимизацию времени выполнения, управление ресурсами и автоматизацию повторяющихся задач.

### Таблица 4: Оптимизация и автоматизация

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `triggers` | Автоматический запуск Pipeline | `cron`, `pollSCM` | ```groovy<br>triggers {<br>  cron('H 4 * * *') // Ежедневно в 4 утра<br>}<br>```<br> ```groovy<br>triggers {<br>  pollSCM('H/5 * * * *') // Проверка SCM каждые 5 минут<br>}<br>``` | **Ошибка**: Триггер не срабатывает.<br>**Решение**: Проверьте синтаксис cron и доступ к SCM. | Автоматизирует запуск. | Интеграция с SCM, cron. |
| `options` | Настройка поведения Pipeline | `timeout`, `retry`, `skipDefaultCheckout` | ```groovy<br>options {<br>  timeout(time: 1, unit: 'HOURS')<br>  retry(3)<br>}<br>``` | **Ошибка**: Timeout превышен.<br>**Решение**: Увеличьте время или оптимизируйте этапы. | Контролирует выполнение. | Влияет на все этапы. |
| `stash`/`unstash` | Передача файлов между этапами | `name`, `includes`, `excludes` | ```groovy<br>stash name: 'build', includes: 'target/*.jar'<br>unstash 'build'<br>``` | **Ошибка**: Stash не найден.<br>**Решение**: Убедитесь, что `stash` вызван до `unstash`. | Экономит время на повторной сборке. | Работает с разными агентами. |

**Важно запомнить**:
- Оптимизация: Используйте `stash` для передачи артефактов, `retry` для отказоустойчивости.
- Автоматизация: Настройте триггеры для регулярных сборок.
- Совместимость: `cron` работает на всех ОС; `stash` требует достаточного дискового пространства.

**Типичные ошибки**:
- Неправильный cron → используйте онлайн-валидаторы.
- Перегрузка диска при `stash` → ограничьте размер файлов.

---

## 5. Отладка и устранение ошибок

**Контекст**: Отладка включает анализ логов, проверку синтаксиса и устранение проблем с агентами.

### Таблица 5: Отладка и устранение ошибок

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `echo` | Вывод сообщений в лог | Строка | ```groovy<br>echo 'Starting build'<br>``` | **Ошибка**: Сообщение не отображается.<br>**Решение**: Проверьте настройки логов. | Помогает в отладке. | Логи сохраняются в Jenkins UI. |
| `catchError` | Обработка ошибок | `buildResult`, `stageResult` | ```groovy<br>catchError(buildResult: 'FAILURE') {<br>  sh 'failing-script.sh'<br>}<br>``` | **Ошибка**: Pipeline прерывается.<br>**Решение**: Используйте `catchError` для продолжения. | Улучшает отказоустойчивость. | Работает с `post`. |
| `script` | Встраивание скриптового кода | Groovy-код | ```groovy<br>script {<br>  if (env.BRANCH_NAME == 'main') {<br>    sh 'deploy.sh'<br>  }<br>}<br>``` | **Ошибка**: Groovy-ошибка.<br>**Решение**: Проверьте синтаксис в валидаторе. | Добавляет гибкость. | Требует прав на выполнение скриптов. |

**Важно запомнить**:
- Логи доступны в Jenkins UI (Console Output).
- Валидатор Pipeline в UI помогает найти синтаксические ошибки.
- Совместимость: Groovy работает одинаково на всех ОС.

**Типичные ошибки**:
- Переполнение логов → настройте ротацию логов.
- Ошибки прав доступа → проверьте настройки безопасности Jenkins.

---

## 6. Рекомендации по оптимизации

- **Кэширование**: Используйте `stash`/`unstash` для артефактов, минимизируя повторные сборки.
- **Модульность**: Разделяйте Pipeline на функции (скриптовой синтаксис) для повторного использования.
- **Безопасность**: Храните секреты в `withCredentials`, избегайте хардкода.
- **Мониторинг**: Используйте плагины (Slack, Email) для уведомлений.
- **Тестирование**: Проверяйте `Jenkinsfile` в валидаторе перед коммитом.---

## 1. Основы Jenkins Pipeline

**Контекст**: Pipeline — автоматизированный процесс CI/CD, описываемый в `Jenkinsfile` (декларативный или скриптовой синтаксис). Позволяет управлять сборкой, тестированием, развертыванием.

### Таблица 1: Основные элементы Pipeline

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `pipeline` | Корневой блок для декларативного Pipeline | `agent`, `stages`, `post` | ```groovy<br>pipeline {<br>  agent any<br>  stages {<br>    stage('Build') {<br>      steps {<br>        sh 'echo Building'<br>      }<br>    }<br>  }<br>}<br>```<br> ```groovy<br>pipeline {<br>  agent { docker 'node:14' }<br>  stages { ... }<br>}<br>``` | **Ошибка**: "No agent specified".<br>**Решение**: Укажите `agent any` или конкретный агент.<br>**Ошибка**: Синтаксическая ошибка.<br>**Решение**: Проверьте отступы и структуру в `Jenkinsfile`. | Определяет структуру всего Pipeline. | Требует настройки агентов и плагинов (Docker, Kubernetes). |
| `agent` | Указывает, где выполняется Pipeline | `any`, `none`, `docker`, `label` | ```groovy<br>agent any // Любой доступный агент<br>```<br> ```groovy<br>agent { label 'linux' } // Агент с меткой<br>```<br> ```groovy<br>agent { docker { image 'maven:3.8' } } // Docker-контейнер<br>``` | **Ошибка**: "No agent with label".<br>**Решение**: Проверьте метки в настройках агентов.<br>**Ошибка**: Docker не запускается.<br>**Решение**: Убедитесь, что плагин Docker установлен и Docker доступен. | Влияет на выбор исполнителя (узел, контейнер). | Интеграция с Docker, Kubernetes, настройка узлов. |
| `stages` | Список этапов выполнения | Список `stage` | ```groovy<br>stages {<br>  stage('Test') {<br>    steps { sh 'make test' }<br>  }<br>}<br>``` | **Ошибка**: Пустой `stages`.<br>**Решение**: Добавьте хотя бы один `stage`. | Определяет последовательность задач. | Зависит от `agent` и `steps`. |
| `steps` | Действия внутри этапа | `sh`, `bat`, `echo`, плагины | ```groovy<br>steps {<br>  sh 'npm install' // Linux<br>  bat 'dir' // Windows<br>}<br>``` | **Ошибка**: "sh not found" на Windows.<br>**Решение**: Используйте `bat` для Windows. | Выполняет команды в контексте агента. | Требует совместимости с ОС агента. |

**Важно запомнить**:
- `Jenkinsfile` хранится в репозитории (SCM) или создается вручную.
- Декларативный синтаксис проще для новичков, скриптовой — для сложной логики.
- Совместимость: Linux, Windows, macOS; Docker требует плагина.

**Типичные ошибки**:
- Неправильные отступы в `Jenkinsfile` → используйте валидатор синтаксиса.
- Отсутствие плагинов → установите необходимые плагины через UI Jenkins.

---

## 2. Настройка и запуск Pipeline

**Контекст**: Настройка Pipeline включает создание `Jenkinsfile`, интеграцию с SCM (Git), настройку агентов и запуск через Jenkins UI.

### Таблица 2: Настройка Pipeline

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `scm` | Интеграция с системой контроля версий | `git`, `branch`, `credentialsId` | ```groovy<br>steps {<br>  git url: 'https://github.com/user/repo.git', branch: 'main'<br>}<br>```<br> ```groovy<br>checkout scm // Автоматическая загрузка из SCM<br>``` | **Ошибка**: "Authentication failed".<br>**Решение**: Настройте `credentialsId` в Jenkins.<br>**Ошибка**: "Branch not found".<br>**Решение**: Проверьте имя ветки. | Загружает код для Pipeline. | Требует плагина Git и настроенных учетных данных. |
| `environment` | Определение переменных окружения | Ключ-значение | ```groovy<br>environment {<br>  APP_ENV = 'prod'<br>  CREDENTIALS = credentials('my-creds')<br>}<br>``` | **Ошибка**: Переменная не найдена.<br>**Решение**: Проверьте синтаксис и область видимости. | Устанавливает переменные для всех этапов. | Используется в `steps`, плагинах. |
| `post` | Действия после выполнения Pipeline | `always`, `success`, `failure` | ```groovy<br>post {<br>  always { echo 'Cleanup' }<br>  failure { mail to: 'team@example.com' }<br>}<br>``` | **Ошибка**: Уведомление не отправлено.<br>**Решение**: Настройте SMTP в Jenkins. | Выполняет финальные действия. | Интеграция с плагинами (Email, Slack). |

**Важно запомнить**:
- SCM требует настройки плагинов (Git, GitHub).
- Переменные окружения чувствительны к области видимости.
- Совместимость: Git работает на всех ОС; Windows требует `bat` для команд.

**Типичные ошибки**:
- Неправильный URL репозитория → проверьте доступность и права.
- Отсутствие учетных данных → добавьте их в Jenkins Credentials.

---

## 3. Продвинутые сценарии

**Контекст**: Продвинутые сценарии включают интеграции (Docker, Kubernetes), безопасность, параллельное выполнение и автоматизацию.

### Таблица 3: Продвинутые элементы Pipeline

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `parallel` | Параллельное выполнение этапов | `stage` внутри `parallel` | ```groovy<br>stages {<br>  stage('Parallel') {<br>    parallel {<br>      stage('Test1') { steps { sh 'test1.sh' } }<br>      stage('Test2') { steps { sh 'test2.sh' } }<br>    }<br>  }<br>}<br>``` | **Ошибка**: Этапы конфликтуют.<br>**Решение**: Используйте разные агенты или `lock`. | Ускоряет выполнение. | Требует достаточных ресурсов агентов. |
| `withCredentials` | Безопасное использование учетных данных | `credentialsId`, `variable` | ```groovy<br>withCredentials([usernamePassword(credentialsId: 'my-creds', usernameVariable: 'USER', passwordVariable: 'PASS')]) {<br>  sh 'curl -u $USER:$PASS https://api'<br>}<br>``` | **Ошибка**: "Credentials not found".<br>**Решение**: Проверьте ID учетных данных. | Защищает чувствительные данные. | Интеграция с Jenkins Credentials. |
| `lock` | Блокировка ресурсов | `resource` | ```groovy<br>lock('db-resource') {<br>  sh 'update-db.sh'<br>}<br>``` | **Ошибка**: Дедлок.<br>**Решение**: Уменьшите время блокировки. | Предотвращает конфликты. | Требует плагина Lockable Resources. |

**Важно запомнить**:
- Параллельное выполнение требует мощных агентов.
- Безопасность: Храните учетные данные в Jenkins, избегайте их в коде.
- Совместимость: `lock` требует плагина; Docker/Kubernetes — соответствующих агентов.

**Типичные ошибки**:
- Перегрузка агентов при `parallel` → ограничьте количество параллельных задач.
- Утечка учетных данных → используйте `withCredentials`.

---

## 4. Оптимизация и автоматизация

**Контекст**: Оптимизация Pipeline включает минимизацию времени выполнения, управление ресурсами и автоматизацию повторяющихся задач.

### Таблица 4: Оптимизация и автоматизация

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `triggers` | Автоматический запуск Pipeline | `cron`, `pollSCM` | ```groovy<br>triggers {<br>  cron('H 4 * * *') // Ежедневно в 4 утра<br>}<br>```<br> ```groovy<br>triggers {<br>  pollSCM('H/5 * * * *') // Проверка SCM каждые 5 минут<br>}<br>``` | **Ошибка**: Триггер не срабатывает.<br>**Решение**: Проверьте синтаксис cron и доступ к SCM. | Автоматизирует запуск. | Интеграция с SCM, cron. |
| `options` | Настройка поведения Pipeline | `timeout`, `retry`, `skipDefaultCheckout` | ```groovy<br>options {<br>  timeout(time: 1, unit: 'HOURS')<br>  retry(3)<br>}<br>``` | **Ошибка**: Timeout превышен.<br>**Решение**: Увеличьте время или оптимизируйте этапы. | Контролирует выполнение. | Влияет на все этапы. |
| `stash`/`unstash` | Передача файлов между этапами | `name`, `includes`, `excludes` | ```groovy<br>stash name: 'build', includes: 'target/*.jar'<br>unstash 'build'<br>``` | **Ошибка**: Stash не найден.<br>**Решение**: Убедитесь, что `stash` вызван до `unstash`. | Экономит время на повторной сборке. | Работает с разными агентами. |

**Важно запомнить**:
- Оптимизация: Используйте `stash` для передачи артефактов, `retry` для отказоустойчивости.
- Автоматизация: Настройте триггеры для регулярных сборок.
- Совместимость: `cron` работает на всех ОС; `stash` требует достаточного дискового пространства.

**Типичные ошибки**:
- Неправильный cron → используйте онлайн-валидаторы.
- Перегрузка диска при `stash` → ограничьте размер файлов.

---

## 5. Отладка и устранение ошибок

**Контекст**: Отладка включает анализ логов, проверку синтаксиса и устранение проблем с агентами.

### Таблица 5: Отладка и устранение ошибок

| Команда/Элемент | Назначение | Параметры | Примеры | Ошибки и решения | Влияние | Взаимодействие |
|-----------------|------------|-----------|---------|------------------|---------|----------------|
| `echo` | Вывод сообщений в лог | Строка | ```groovy<br>echo 'Starting build'<br>``` | **Ошибка**: Сообщение не отображается.<br>**Решение**: Проверьте настройки логов. | Помогает в отладке. | Логи сохраняются в Jenkins UI. |
| `catchError` | Обработка ошибок | `buildResult`, `stageResult` | ```groovy<br>catchError(buildResult: 'FAILURE') {<br>  sh 'failing-script.sh'<br>}<br>``` | **Ошибка**: Pipeline прерывается.<br>**Решение**: Используйте `catchError` для продолжения. | Улучшает отказоустойчивость. | Работает с `post`. |
| `script` | Встраивание скриптового кода | Groovy-код | ```groovy<br>script {<br>  if (env.BRANCH_NAME == 'main') {<br>    sh 'deploy.sh'<br>  }<br>}<br>``` | **Ошибка**: Groovy-ошибка.<br>**Решение**: Проверьте синтаксис в валидаторе. | Добавляет гибкость. | Требует прав на выполнение скриптов. |

**Важно запомнить**:
- Логи доступны в Jenkins UI (Console Output).
- Валидатор Pipeline в UI помогает найти синтаксические ошибки.
- Совместимость: Groovy работает одинаково на всех ОС.

**Типичные ошибки**:
- Переполнение логов → настройте ротацию логов.
- Ошибки прав доступа → проверьте настройки безопасности Jenkins.

---

## 6. Рекомендации по оптимизации

- **Кэширование**: Используйте `stash`/`unstash` для артефактов, минимизируя повторные сборки.
- **Модульность**: Разделяйте Pipeline на функции (скриптовой синтаксис) для повторного использования.
- **Безопасность**: Храните секреты в `withCredentials`, избегайте хардкода.
- **Мониторинг**: Используйте плагины (Slack, Email) для уведомлений.
- **Тестирование**: Проверяйте `Jenkinsfile` в валидаторе перед коммитом.
